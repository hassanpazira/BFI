<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calling BFI from Python • BFI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calling BFI from Python">
<meta name="description" content="How to use the BFI package in Python environments.
">
<meta property="og:description" content="How to use the BFI package in Python environments.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BFI</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BFI.html">An Introduction to BFI</a></li>
    <li><a class="dropdown-item" href="../articles/Python.html">Calling BFI from Python</a></li>
    <li><a class="dropdown-item" href="../articles/SAS.html">Using BFI in SAS</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hassanpazira/BFI"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calling BFI from Python</h1>
                        <h4 data-toc-skip class="author">Hassan
Pazira</h4>
            
            <h4 data-toc-skip class="date">2024-11-08</h4>
      

      <div class="d-none name"><code>Python.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>BFI</code> is an <strong>R</strong> package that performs
<strong>Bayesian Federated Inference</strong> (<strong>BFI</strong>) for
<em>linear</em>, <em>logistic</em>, and <em>survival</em> regression
models. Since there is no <strong>Python</strong> package for carrying
out the <em>BFI</em> method so far, this vignette describes the usage of
the R package <code>BFI</code> in the Python environment.</p>
<p>To move to the Python environment, we need to prepare our operating
system. Although, we explain in the following how to prepare it in
different systems (‘<em>MacOS</em>’, ‘<em>Ubuntu</em>’ and
‘<em>Windows</em>’), we recommend that to use ‘<em>Google Colab</em>’ to
write and execute (the following) Python codes which can be done in any
system through a browser without any preparations.</p>
</div>
<div class="section level2">
<h2 id="google-colab">Google Colab<a class="anchor" aria-label="anchor" href="#google-colab"></a>
</h2>
<p>First go to <em>Google Colab</em> from <a href="https://colab.google" class="external-link uri">https://colab.google</a> or <a href="https://colab.research.google.com" class="external-link uri">https://colab.research.google.com</a>, and then click on
<em>New Notebook</em>. Now, skip the two following sections and jump to
the section <a href="#Python">Python Script</a>.</p>
</div>
<div class="section level2">
<h2 id="python-installation">Python Installation<a class="anchor" aria-label="anchor" href="#python-installation"></a>
</h2>
<p>The steps to install the latest version of Python on ‘MacOS’,
‘Ubuntu’ and ‘Windows’ are as follows:</p>
<div class="section level3">
<h3 id="on-macos">On MacOS<a class="anchor" aria-label="anchor" href="#on-macos"></a>
</h3>
<p>Open a terminal window (cmd + space and search ‘Terminal’) and
install the package manager ‘Homebrew’ by executing the following
command:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">/</span>bin<span class="sc">/</span>bash <span class="sc">-</span>c <span class="st">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"</span></span></code></pre></div>
<p>Install the latest version of Python (Python 3) with the following
command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>brew install python<span class="sc">@</span><span class="dv">3</span></span></code></pre></div>
<p>Verify the installation by checking the Python version:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">python3</span> <span class="op">-</span><span class="op">-</span><span class="va">version</span></span></code></pre></div>
<p>It’s assumed that R is also installed and configured on your system.
If not, the following can do it:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Install XCode command-line tools</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>xcode<span class="sc">-</span>select <span class="sc">--</span>install</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Install R</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>brew install <span class="sc">--</span>cask r</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="on-ubuntu">On Ubuntu<a class="anchor" aria-label="anchor" href="#on-ubuntu"></a>
</h3>
<p>Update package repositories and get latest package information by
running the following command in a terminal window:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>sudo apt<span class="sc">-</span>get update <span class="sc">-</span>y</span></code></pre></div>
<p>Verify if Python is indeed installed on your system by the following
command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">python3</span> <span class="op">-</span><span class="op">-</span><span class="va">version</span></span></code></pre></div>
<p>If you already have Python (Python 3) installed on your system, you
only need to upgrade it to the latest version as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>sudo apt<span class="sc">-</span>get upgrade python3</span></code></pre></div>
<p>In case you did not have Python installed in the first place, the
latest version of Python can be installed using the following
command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3</span></code></pre></div>
<p>Verify the installation by checking the Python version:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">python3</span> <span class="op">-</span><span class="op">-</span><span class="va">version</span></span></code></pre></div>
<p>If you don’t have R installed and configured, just run the
following:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Install R</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install r<span class="sc">-</span>base</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="on-windows">On Windows<a class="anchor" aria-label="anchor" href="#on-windows"></a>
</h3>
<p>By default, Python is usually not installed on Windows. However, you
can check if it exists on the system by running one line of command on
the command prompt. Go to <strong>Start</strong> and enter
<code>cmd</code> in the search bar, and then click <strong>Command
Prompt</strong>. Enter the command <code>python --version</code> or
<code>python3 --version</code> in the command prompt.</p>
<p>To download Python, go to the official Python download website for
Windows: <a href="https://www.python.org" class="external-link uri">https://www.python.org</a>. Find a stable Python 3 release,
and download the executable file for your system from the appropriate
link.</p>
<p>After the installer is downloaded, open/run the Python installer to
install Python. Select the <strong>Add Python 3.x to PATH</strong>
checkbox, which enables users to launch Python from the command line,
and then select <strong>Install Now</strong>.</p>
<p>Once the installation is complete, you can verify whether the Python
installation is successful through the command line. Enter the command
<code>python --version</code> or <code>python3 --version</code> in the
command prompt.</p>
<p>It’s assumed that R is also installed on your system. If you don’t
have R installed, just visit CRAN downloads (<a href="https://cran.r-project.org" class="external-link uri">https://cran.r-project.org</a>) and get the last
version.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation-of-required-modules">Installation of Required Modules<a class="anchor" aria-label="anchor" href="#installation-of-required-modules"></a>
</h2>
<p>Here the required modules are installed through PIP. PIP (a Python
package manager) helps us to install and use various packages/modules in
Python programming.</p>
<p>Install the latest version of PIP and required modules by running the
following commands on different systems.</p>
<div class="section level3">
<h3 id="on-macos-1">On MacOS<a class="anchor" aria-label="anchor" href="#on-macos-1"></a>
</h3>
<p>Install/Upgrade the latest version of PIP by running</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Installing PIP</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>python3 <span class="sc">-</span>m pip install <span class="sc">--</span>user <span class="sc">--</span>upgrade pip</span></code></pre></div>
<p>Install required modules by running the following commands</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Installing the 'pandas' module</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>pip3 install pandas</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Installing the 'numpy' module</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>pip3 install numpy</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Installing the 'pickle' module</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>pip3 install pickle</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># Installing the 'rpy2' module</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>pip3 install rpy2</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="on-ubuntu-1">On Ubuntu<a class="anchor" aria-label="anchor" href="#on-ubuntu-1"></a>
</h3>
<p>To install PIP use the code</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Installing PIP</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3<span class="sc">-</span>pip</span></code></pre></div>
<p>Verify you have successfully installed PIP by running</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip3</span> <span class="op">-</span><span class="va">V</span></span></code></pre></div>
<p>Now, install required modules by typing the following commands</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Installing the 'pandas' module</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>sudo pip3 install pandas</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># Installing the 'numpy' module</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>sudo pip3 install numpy</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># Installing the 'pickle' module</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>sudo pip3 install pickle</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co"># Installing the 'rpy2' module</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>sudo pip3 install rpy2</span></code></pre></div>
<p>If the lines above for installation of the modules did not install
them, use the following:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Installing the 'pandas' module</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3<span class="sc">-</span>pandas</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># Installing the 'numpy' module</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3<span class="sc">-</span>numpy</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># Installing the 'pickle' module</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3<span class="sc">-</span>pickle</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co"># Installing the 'rpy2' module</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install python3<span class="sc">-</span>rpy2</span></code></pre></div>
<p>Finally, use the show command to verify whether the module is now
part of your Python packages:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>pip3 show pandas</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>pip3 show numpy</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>pip3 show pickle</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>pip3 show rpy2</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="on-windows-1">On Windows<a class="anchor" aria-label="anchor" href="#on-windows-1"></a>
</h3>
<p>Usually, PIP is automatically installed if you are using Python
downloaded from <a href="https://www.python.org" class="external-link uri">https://www.python.org</a>. If you have followed the
previous steps provided in this vignette, then you have PIP installed on
your system. To check if PIP is already installed on Windows, you should
open the command line again, type <code>pip -V</code>, and press
<code>Enter</code>.</p>
<p>If PIP is not installed: First download <a href="https://bootstrap.pypa.io/get-pip.py" class="external-link">get-pip.py</a> to a folder
on your computer. Then, open a command prompt and navigate to the folder
containing the get-pip.py installer. Finally, run the following
command:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>python get<span class="sc">-</span>pip.py</span></code></pre></div>
<p>PIP should now be installed successfully. If we receive a ‘file not
found’ error, double check the directory path to the file. You can use
the <code>dir</code> command to view the entire contents of a directory.
More information can be found here: <a href="https://pip.pypa.io/en/stable/installation" class="external-link uri">https://pip.pypa.io/en/stable/installation</a>.</p>
<p>Now, install required modules by running the following commands:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Installing the 'pandas' module</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>pip3 install pandas</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># Installing the 'numpy' module</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>pip3 install numpy</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># Installing the 'pickle' module</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>pip3 install pickle</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co"># Installing the 'rpy2' module</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>pip3 install rpy2</span></code></pre></div>
<p>Now, you can start coding in Python using Python’s command-line
interpreter or IDLE application. Go to <code>Start</code> and enter
<code>python</code> in the search bar. You can see Python 3.x and IDLE
which can be used for coding. Open one of them and follow the following
steps.</p>
</div>
</div>
<div class="section level2">
<h2 id="Python">Python Script<a class="anchor" aria-label="anchor" href="#Python"></a>
</h2>
<p>It is assumed here that the required packages has been properly
installed, which is the case in <em>Google Colab</em>. Now move on to
work with the <code>rpy2</code> package inside a Python script! If you
are not in the Python script, first go to the Python Environment by
typing the following command in the terminal window (you should skip
this line if you are already in <em>Google Colab</em>):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">python3</span></span></code></pre></div>
<p>As of now, all the following codes should be run in the Python
environment. If you want to copy all codes at once go to <a href="#allcodes">the last section</a>.</p>
<div class="section level3">
<h3 id="importing-python-modules-and-functions">Importing <code>Python</code> modules and functions<a class="anchor" aria-label="anchor" href="#importing-python-modules-and-functions"></a>
</h3>
<p>Use the following codes to import required Python modules:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># import 'pandas' package</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># import 'numpy' package</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                </span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co"># import 'pickle' package</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co"># import 'rpy2' package</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="im">import</span> rpy2                  </span></code></pre></div>
<p>and using the following codes imports the required functions such as
<code>importr()</code> and <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.packages <span class="im">import</span> importr, data</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.vectors <span class="im">import</span> StrVector</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="im">from</span> rpy2.robjects <span class="im">import</span> numpy2ri, pandas2ri</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co"># activation of the automatic conversion of 'numpy' and 'pandas' objects into rpy2 objects</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>numpy2ri.activate()   </span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>pandas2ri.activate()</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installing-r-packages-from-cran-and-github">Installing <code>R</code> packages from CRAN and GitHub<a class="anchor" aria-label="anchor" href="#installing-r-packages-from-cran-and-github"></a>
</h3>
<p>First load the packages preinstalled with R using
<code>importr()</code> as follows:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># import R's "utils" package</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>utils <span class="op">=</span> importr(<span class="st">'utils'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co"># import R's "base" package</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>base <span class="op">=</span> importr(<span class="st">'base'</span>)</span></code></pre></div>
<p>Then install the R packages <code>stats</code> and <code>BFI</code>
from CRAN by typing</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>utils.chooseCRANmirror(ind<span class="op">=</span><span class="dv">1</span>)  <span class="co"># which selects the first mirror in the list</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>package_names <span class="op">=</span> (<span class="st">'stats'</span>, <span class="st">'BFI'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>utils.install_packages(StrVector(package_names))</span></code></pre></div>
<p>Now load the installed packages using</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>stats <span class="op">=</span> importr(<span class="st">'stats'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>BFI <span class="op">=</span> importr(<span class="st">'BFI'</span>)</span></code></pre></div>
<div class="section level4">
<h4 id="installing-the-bfi-package-from-github-if-necessary">Installing the <code>BFI</code> package from GitHub (if
necessary)<a class="anchor" aria-label="anchor" href="#installing-the-bfi-package-from-github-if-necessary"></a>
</h4>
<p>If you want to install the <code>BFI</code> package from GitHub
(instead of CRAN), it can be installed and loaded using the following
lines:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>utils.chooseCRANmirror(ind<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>utils.install_packages(<span class="st">'devtools'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>devtools <span class="op">=</span> importr(<span class="st">'devtools'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co"># Installing the 'BFI' package</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>devtools.install_github(<span class="st">"hassanpazira/BFI"</span>, force <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co"># Loading the package</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>BFI <span class="op">=</span> importr(<span class="st">'BFI'</span>)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="applying-bfi-method-to-the-simulated-data">Applying BFI method to the simulated data<a class="anchor" aria-label="anchor" href="#applying-bfi-method-to-the-simulated-data"></a>
</h2>
<p>Now we generate two datasets independently from Gaussian
distribution, and then apply main functions in the <code>BFI</code>
package to these datasets:</p>
<div class="section level3">
<h3 id="data-simulation-for-two-local-centers">Data Simulation for two Local Centers<a class="anchor" aria-label="anchor" href="#data-simulation-for-two-local-centers"></a>
</h3>
<p>First generate 30 samples randomly from Gaussian distribution with 3
covariates:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># model parameters: 'theta' and 'p' are assumed to be the same for both centers:</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>theta <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="fl">0.75</span>])   <span class="co"># intercept is theta[0], sigma2 is theta[4]</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">3</span>     <span class="co"># number of regression parameters without intercept</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co"># Center 1:</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>n1 <span class="op">=</span> <span class="dv">30</span>   <span class="co"># sample size of center 1</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>X1 <span class="op">=</span> np.random.normal(size<span class="op">=</span>(n1, p)) </span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>X1.shape   <span class="co"># dimension of X1</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>X1 <span class="op">=</span> pd.DataFrame(X1, columns<span class="op">=</span>[<span class="st">'X1'</span>, <span class="st">'X2'</span>, <span class="st">'X3'</span>])</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>mu1 <span class="op">=</span> theta[<span class="dv">0</span>] <span class="op">+</span> np.dot(X1, np.delete(theta, [<span class="dv">0</span>, <span class="dv">4</span>]))  <span class="co"># for gaussian: \eta = \mu </span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>X1 <span class="op">=</span> pandas2ri.py2rpy(X1)   <span class="co"># == base.as_data_frame(X1)</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>y1 <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu1, scale<span class="op">=</span>np.sqrt(theta[<span class="dv">4</span>]))</span></code></pre></div>
<p>Then generate randomly 50 samples from Gaussian distribution with 3
covariates:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Center 2:</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>n2 <span class="op">=</span> <span class="dv">50</span>   <span class="co"># sample size of center 2</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>X2 <span class="op">=</span> np.random.normal(size<span class="op">=</span>(n2, p))</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>X2 <span class="op">=</span> pd.DataFrame(X2, columns<span class="op">=</span>[<span class="st">'X1'</span>, <span class="st">'X2'</span>, <span class="st">'X3'</span>])</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>mu2 <span class="op">=</span> theta[<span class="dv">0</span>] <span class="op">+</span> np.dot(X2, np.delete(theta, [<span class="dv">0</span>, <span class="dv">4</span>]))</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>X2 <span class="op">=</span> pandas2ri.py2rpy(X2)</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>y2 <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu2, scale<span class="op">=</span>np.sqrt(theta[<span class="dv">4</span>]))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-estimates-at-the-local-centers">MAP Estimates at the Local Centers<a class="anchor" aria-label="anchor" href="#map-estimates-at-the-local-centers"></a>
</h3>
<p>The following compute the Maximum A Posterior (MAP) estimators of the
parameters for center 1:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Creating an inverse covariance matrix for a Gaussian prior for center 1</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>Lambda1 <span class="op">=</span> BFI.inv_prior_cov(X1, <span class="fl">0.01</span>, <span class="st">'gaussian'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>fit1 <span class="op">=</span> BFI.MAP_estimation(y1, X1, <span class="st">'gaussian'</span>, Lambda1)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="bu">print</span>(fit1)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>theta_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"theta_hat"</span>) <span class="co"># MAP estimates of the intercept and coefficients</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>A_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"A_hat"</span>)         <span class="co"># minus the curvature matrix</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>summary_1 <span class="op">=</span> BFI.summary_bfi(fit1, cur_mat <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<p>Obtaining the MAP estimators of the parameters for center 2 using the
following:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># Creating an inverse covariance matrix for Gaussian prior for center 2</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>Lambda2 <span class="op">=</span> BFI.inv_prior_cov(X2, <span class="fl">0.01</span>, <span class="st">'gaussian'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co"># MAP estimates</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>fit2 <span class="op">=</span> BFI.MAP_estimation(y2, X2, <span class="st">'gaussian'</span>, Lambda2)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>theta_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"theta_hat"</span>) <span class="co"># MAP estimates of the parameters</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>A_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"A_hat"</span>)         <span class="co"># minus the curvature matrix around 'theta_hat2'</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>summary_2 <span class="op">=</span> BFI.summary_bfi(fit2, cur_mat <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sending-the-required-files-to-central-server">Sending the Required Files to Central Server<a class="anchor" aria-label="anchor" href="#sending-the-required-files-to-central-server"></a>
</h3>
<p>The required outputs for using the central server are
<code>fit1</code> for center 1 and <code>fit2</code> for center 2. To
send these outputs to the central server, you can save the list to a
file in a common format (such as RDS, JSON, or CSV). This will allow the
central server to open the file in either R or Python environments.</p>
<div class="section level4">
<h4 id="central-server-with-r">Central server with R<a class="anchor" aria-label="anchor" href="#central-server-with-r"></a>
</h4>
<p>If the central server is using R, follow the instructions below. If
it is using Python, go to the next subsection: <a href="#server_python">Central server with Python</a>. We will show how
to do this for <code>fit1</code> at center 1. The process is the same
for center 2. Since <code>fit1</code> is an R object and the central
server is using R, you can save it as an RDS file, which is a file
format native to R for single R objects.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="im">import</span> rpy2.robjects <span class="im">as</span> ro</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co"># Save fit1 as an RDS file</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>ro.r(<span class="st">'saveRDS(fit1, file="fit1.rds")'</span>)</span></code></pre></div>
<p>This file, <code>fit1.rds</code> should be sent to the central
server, where it can be loaded as follows:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># Load the saved RDS file</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>fit1 <span class="op">&lt;-</span> readRDS(<span class="st">"fit1.rds"</span>) <span class="co"># use the relative path to the file</span></span></code></pre></div>
<p>Now, the variable <code>fit1</code> is a list in R containing all
information needed for further analysis:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>theta_hat1 <span class="op">&lt;-</span> fit1$theta_hat</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>A_hat1 <span class="op">&lt;-</span> fit1$A_hat</span></code></pre></div>
<p>To see how to proceed and use <code><a href="../reference/BFI.html">bfi()</a></code> in R, see, for
example, <a href="https://hassanpazira.github.io/BFI/reference/BFI.html">here</a>.</p>
</div>
<div class="section level4">
<h4 id="server_python">Central server with Python<a class="anchor" aria-label="anchor" href="#server_python"></a>
</h4>
<p>If the central server is using Python, follow the instructions below.
We will show how to do this for <code>fit1</code> at center 1. The
process is the same for center 2. Since <code>fit1</code> needs to be
shared with the central server which is using Python, you can serialize
it using the <code>pickle</code> module, which is a common way to save
Python objects. At the center 1, use the following to create
<code>fit1.pkl</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># Save fit1 as a pickle file</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    pickle.dump(fit1, f)</span></code></pre></div>
<p>Now, the file <code>fit1.pkl</code> should be sent to the central
server, where it can be loaded as follows:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Load the pickle file</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:  <span class="co"># use the relative path to the file</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>    fit1 <span class="op">=</span> pickle.load(f)</span></code></pre></div>
<p>The variable <code>fit1</code> contains all information needed for
further analysis in the central server. To see how to proceed and obtain
the BFI estimates on the central server, follow the next section.</p>
</div>
</div>
<div class="section level3">
<h3 id="bfi-at-central-server-using-python">BFI at Central Server (using Python)<a class="anchor" aria-label="anchor" href="#bfi-at-central-server-using-python"></a>
</h3>
<p>On the central server, first load the files saved to a proper
address:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># Load the file form center 1</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f: <span class="co"># use the relative path to the file</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>    fit1 <span class="op">=</span> pickle.load(f)</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="co"># Load the file form center 2, using the relative path to the file</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>    fit2 <span class="op">=</span> pickle.load(f)</span></code></pre></div>
<p>Now, The main function <code><a href="../reference/BFI.html">bfi()</a></code> can be used to obtain the
BFI estimates:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>theta_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"theta_hat"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>A_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"A_hat"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>theta_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"theta_hat"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>A_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"A_hat"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>theta_hats <span class="op">=</span> base.<span class="bu">list</span>(theta_hat1, theta_hat2)</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>A_hats <span class="op">=</span> base.<span class="bu">list</span>(A_hat1, A_hat2)</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>Lambda1 <span class="op">=</span> pd.DataFrame(Lambda1, index<span class="op">=</span>fit1.rx2(<span class="st">"names"</span>), columns<span class="op">=</span>fit1.rx2(<span class="st">"names"</span>))</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>Lambda2 <span class="op">=</span> pd.DataFrame(Lambda2, index<span class="op">=</span>fit2.rx2(<span class="st">"names"</span>), columns<span class="op">=</span>fit2.rx2(<span class="st">"names"</span>))</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>Lambdas <span class="op">=</span> base.<span class="bu">list</span>(Lambda1, Lambda2)</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>fit_bfi <span class="op">=</span> BFI.bfi(theta_hats, A_hats, Lambdas)</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="bu">print</span>(fit_bfi)</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>summary_bfi <span class="op">=</span> BFI.summary_bfi(fit_bfi, cur_mat <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="datasets-included-in-the-bfi-package">Datasets included in the <code>BFI</code> package<a class="anchor" aria-label="anchor" href="#datasets-included-in-the-bfi-package"></a>
</h2>
<p>To find a list of all datasets included in the package run:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="bu">print</span>(utils.data(package <span class="op">=</span> <span class="st">"BFI"</span>))</span></code></pre></div>
<p>In order to use the datasets available from the <code>BFI</code>
package, use the following codes:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>Nurses <span class="op">=</span> data(BFI).fetch(<span class="st">'Nurses'</span>)[<span class="st">'Nurses'</span>]  <span class="co"># is equivalent to BFI::Nurses in R</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dimension of the 'Nurses' data: </span><span class="ch">\n</span><span class="st">"</span>, base.dim(Nurses))</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Colnames of the 'Nurses' data: </span><span class="ch">\n</span><span class="st">"</span>, base.colnames(Nurses))</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>trauma <span class="op">=</span> data(BFI).fetch(<span class="st">'trauma'</span>)[<span class="st">'trauma'</span>]  <span class="co"># is equivalent to BFI::trauma in R</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dimension of the 'trauma' data: </span><span class="ch">\n</span><span class="st">"</span>, base.dim(trauma))</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Colnames of the 'trauma' data: </span><span class="ch">\n</span><span class="st">"</span>, base.colnames(trauma))</span></code></pre></div>
<p>At the end, use the following to deactivate automatic conversion:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>numpy2ri.deactivate()</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>pandas2ri.deactivate()</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="allcodes">All codes together<a class="anchor" aria-label="anchor" href="#allcodes"></a>
</h2>
<p>If you need all the codes at once to copy and paste them for example
into <em>Google Colab</em>, here’s the complete codes:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># import 'pandas' package</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="co"># import 'numpy' package</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                </span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="co"># import 'pickle' package</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a><span class="co"># import 'rpy2' package</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a><span class="im">import</span> rpy2                  </span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.packages <span class="im">import</span> importr, data</span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.vectors <span class="im">import</span> StrVector</span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a><span class="im">from</span> rpy2.robjects <span class="im">import</span> numpy2ri, pandas2ri</span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a><span class="co"># activation of the automatic conversion of 'numpy' and 'pandas' objects into rpy2 objects</span></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a>numpy2ri.activate()   </span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a>pandas2ri.activate()</span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a><span class="co"># import R's "utils" package</span></span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a>utils <span class="op">=</span> importr(<span class="st">'utils'</span>)</span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a><span class="co"># import R's "base" package</span></span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a>base <span class="op">=</span> importr(<span class="st">'base'</span>)</span>
<span id="cb41-25"><a href="#cb41-25" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" tabindex="-1"></a>utils.chooseCRANmirror(ind<span class="op">=</span><span class="dv">1</span>)  <span class="co"># which selects the first mirror in the list</span></span>
<span id="cb41-27"><a href="#cb41-27" tabindex="-1"></a>package_names <span class="op">=</span> (<span class="st">'stats'</span>, <span class="st">'BFI'</span>)</span>
<span id="cb41-28"><a href="#cb41-28" tabindex="-1"></a>utils.install_packages(StrVector(package_names))</span>
<span id="cb41-29"><a href="#cb41-29" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" tabindex="-1"></a><span class="co"># loading the installed packages</span></span>
<span id="cb41-31"><a href="#cb41-31" tabindex="-1"></a>stats <span class="op">=</span> importr(<span class="st">'stats'</span>)</span>
<span id="cb41-32"><a href="#cb41-32" tabindex="-1"></a>BFI <span class="op">=</span> importr(<span class="st">'BFI'</span>)</span>
<span id="cb41-33"><a href="#cb41-33" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" tabindex="-1"></a><span class="co">## Examples</span></span>
<span id="cb41-35"><a href="#cb41-35" tabindex="-1"></a></span>
<span id="cb41-36"><a href="#cb41-36" tabindex="-1"></a><span class="co"># model parameters: 'theta' and 'p' are assumed to be the same for both centers:</span></span>
<span id="cb41-37"><a href="#cb41-37" tabindex="-1"></a>theta <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="fl">0.75</span>])   <span class="co"># intercept is theta[0], sigma2 is theta[4]</span></span>
<span id="cb41-38"><a href="#cb41-38" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">3</span>     <span class="co"># number of regression parameters without intercept</span></span>
<span id="cb41-39"><a href="#cb41-39" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" tabindex="-1"></a><span class="co"># Data Simulation for center 1</span></span>
<span id="cb41-41"><a href="#cb41-41" tabindex="-1"></a>n1 <span class="op">=</span> <span class="dv">30</span>   <span class="co"># sample size of center 1</span></span>
<span id="cb41-42"><a href="#cb41-42" tabindex="-1"></a>X1 <span class="op">=</span> np.random.normal(size<span class="op">=</span>(n1, p)) </span>
<span id="cb41-43"><a href="#cb41-43" tabindex="-1"></a>X1.shape   <span class="co"># dimension of X1</span></span>
<span id="cb41-44"><a href="#cb41-44" tabindex="-1"></a>X1 <span class="op">=</span> pd.DataFrame(X1, columns<span class="op">=</span>[<span class="st">'X1'</span>, <span class="st">'X2'</span>, <span class="st">'X3'</span>])</span>
<span id="cb41-45"><a href="#cb41-45" tabindex="-1"></a>mu1 <span class="op">=</span> theta[<span class="dv">0</span>] <span class="op">+</span> np.dot(X1, np.delete(theta, [<span class="dv">0</span>, <span class="dv">4</span>]))  <span class="co"># for gaussian: \eta = \mu </span></span>
<span id="cb41-46"><a href="#cb41-46" tabindex="-1"></a>X1 <span class="op">=</span> pandas2ri.py2rpy(X1)   <span class="co"># == base.as_data_frame(X1)</span></span>
<span id="cb41-47"><a href="#cb41-47" tabindex="-1"></a>y1 <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu1, scale<span class="op">=</span>np.sqrt(theta[<span class="dv">4</span>]))</span>
<span id="cb41-48"><a href="#cb41-48" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" tabindex="-1"></a><span class="co"># Data Simulation for center 2</span></span>
<span id="cb41-50"><a href="#cb41-50" tabindex="-1"></a>n2 <span class="op">=</span> <span class="dv">50</span>   <span class="co"># sample size of center 2</span></span>
<span id="cb41-51"><a href="#cb41-51" tabindex="-1"></a>X2 <span class="op">=</span> np.random.normal(size<span class="op">=</span>(n2, p))</span>
<span id="cb41-52"><a href="#cb41-52" tabindex="-1"></a>X2 <span class="op">=</span> pd.DataFrame(X2, columns<span class="op">=</span>[<span class="st">'X1'</span>, <span class="st">'X2'</span>, <span class="st">'X3'</span>])</span>
<span id="cb41-53"><a href="#cb41-53" tabindex="-1"></a>mu2 <span class="op">=</span> theta[<span class="dv">0</span>] <span class="op">+</span> np.dot(X2, np.delete(theta, [<span class="dv">0</span>, <span class="dv">4</span>]))</span>
<span id="cb41-54"><a href="#cb41-54" tabindex="-1"></a>X2 <span class="op">=</span> pandas2ri.py2rpy(X2)</span>
<span id="cb41-55"><a href="#cb41-55" tabindex="-1"></a>y2 <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu2, scale<span class="op">=</span>np.sqrt(theta[<span class="dv">4</span>]))</span>
<span id="cb41-56"><a href="#cb41-56" tabindex="-1"></a></span>
<span id="cb41-57"><a href="#cb41-57" tabindex="-1"></a><span class="co">## MAP estimates at center 1</span></span>
<span id="cb41-58"><a href="#cb41-58" tabindex="-1"></a><span class="co"># Creating an inverse covariance matrix for a Gaussian prior for center 1</span></span>
<span id="cb41-59"><a href="#cb41-59" tabindex="-1"></a>Lambda1 <span class="op">=</span> BFI.inv_prior_cov(X1, <span class="fl">0.01</span>, <span class="st">'gaussian'</span>)</span>
<span id="cb41-60"><a href="#cb41-60" tabindex="-1"></a>fit1 <span class="op">=</span> BFI.MAP_estimation(y1, X1, <span class="st">'gaussian'</span>, Lambda1)</span>
<span id="cb41-61"><a href="#cb41-61" tabindex="-1"></a><span class="bu">print</span>(fit1)</span>
<span id="cb41-62"><a href="#cb41-62" tabindex="-1"></a>theta_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"theta_hat"</span>) <span class="co"># MAP estimates of the intercept and coefficients</span></span>
<span id="cb41-63"><a href="#cb41-63" tabindex="-1"></a>A_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"A_hat"</span>)         <span class="co"># minus the curvature matrix</span></span>
<span id="cb41-64"><a href="#cb41-64" tabindex="-1"></a>summary_1 <span class="op">=</span> BFI.summary_bfi(fit1, cur_mat <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-65"><a href="#cb41-65" tabindex="-1"></a><span class="co"># Save fit1 as a pickle file for sending to the central server</span></span>
<span id="cb41-66"><a href="#cb41-66" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb41-67"><a href="#cb41-67" tabindex="-1"></a>    pickle.dump(fit1, f)</span>
<span id="cb41-68"><a href="#cb41-68" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" tabindex="-1"></a><span class="co">## MAP estimates at center 2</span></span>
<span id="cb41-70"><a href="#cb41-70" tabindex="-1"></a><span class="co"># Creating an inverse covariance matrix for Gaussian prior for center 2</span></span>
<span id="cb41-71"><a href="#cb41-71" tabindex="-1"></a>Lambda2 <span class="op">=</span> BFI.inv_prior_cov(X2, <span class="fl">0.01</span>, <span class="st">'gaussian'</span>)</span>
<span id="cb41-72"><a href="#cb41-72" tabindex="-1"></a><span class="co"># MAP estimates</span></span>
<span id="cb41-73"><a href="#cb41-73" tabindex="-1"></a>fit2 <span class="op">=</span> BFI.MAP_estimation(y2, X2, <span class="st">'gaussian'</span>, Lambda2)</span>
<span id="cb41-74"><a href="#cb41-74" tabindex="-1"></a>theta_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"theta_hat"</span>) <span class="co"># MAP estimates of the parameters</span></span>
<span id="cb41-75"><a href="#cb41-75" tabindex="-1"></a>A_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"A_hat"</span>)         <span class="co"># minus the curvature matrix around 'theta_hat2'</span></span>
<span id="cb41-76"><a href="#cb41-76" tabindex="-1"></a>summary_2 <span class="op">=</span> BFI.summary_bfi(fit2, cur_mat <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-77"><a href="#cb41-77" tabindex="-1"></a><span class="co"># Save fit2 as a pickle file for sending to the central server</span></span>
<span id="cb41-78"><a href="#cb41-78" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit2.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb41-79"><a href="#cb41-79" tabindex="-1"></a>    pickle.dump(fit2, f)</span>
<span id="cb41-80"><a href="#cb41-80" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" tabindex="-1"></a><span class="co">## BFI at central server</span></span>
<span id="cb41-82"><a href="#cb41-82" tabindex="-1"></a><span class="co"># Load the pickle file using the relative path to the file</span></span>
<span id="cb41-83"><a href="#cb41-83" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:  <span class="co"># use the relative path to the file</span></span>
<span id="cb41-84"><a href="#cb41-84" tabindex="-1"></a>    fit1 <span class="op">=</span> pickle.load(f)</span>
<span id="cb41-85"><a href="#cb41-85" tabindex="-1"></a>theta_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"theta_hat"</span>)</span>
<span id="cb41-86"><a href="#cb41-86" tabindex="-1"></a>A_hat1 <span class="op">=</span> fit1.rx2(<span class="st">"A_hat"</span>)</span>
<span id="cb41-87"><a href="#cb41-87" tabindex="-1"></a><span class="co"># Load the pickle file using the relative path to the file</span></span>
<span id="cb41-88"><a href="#cb41-88" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'fit2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb41-89"><a href="#cb41-89" tabindex="-1"></a>    fit2 <span class="op">=</span> pickle.load(f)</span>
<span id="cb41-90"><a href="#cb41-90" tabindex="-1"></a>theta_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"theta_hat"</span>)</span>
<span id="cb41-91"><a href="#cb41-91" tabindex="-1"></a>A_hat2 <span class="op">=</span> fit2.rx2(<span class="st">"A_hat"</span>)</span>
<span id="cb41-92"><a href="#cb41-92" tabindex="-1"></a>theta_hats <span class="op">=</span> base.<span class="bu">list</span>(theta_hat1, theta_hat2)</span>
<span id="cb41-93"><a href="#cb41-93" tabindex="-1"></a>A_hats <span class="op">=</span> base.<span class="bu">list</span>(A_hat1, A_hat2)</span>
<span id="cb41-94"><a href="#cb41-94" tabindex="-1"></a>Lambda1 <span class="op">=</span> pd.DataFrame(Lambda1, index<span class="op">=</span>fit1.rx2(<span class="st">"names"</span>), columns<span class="op">=</span>fit1.rx2(<span class="st">"names"</span>))</span>
<span id="cb41-95"><a href="#cb41-95" tabindex="-1"></a>Lambda2 <span class="op">=</span> pd.DataFrame(Lambda2, index<span class="op">=</span>fit2.rx2(<span class="st">"names"</span>), columns<span class="op">=</span>fit2.rx2(<span class="st">"names"</span>))</span>
<span id="cb41-96"><a href="#cb41-96" tabindex="-1"></a>Lambdas <span class="op">=</span> base.<span class="bu">list</span>(Lambda1, Lambda2)</span>
<span id="cb41-97"><a href="#cb41-97" tabindex="-1"></a>fit_bfi <span class="op">=</span> BFI.bfi(theta_hats, A_hats, Lambdas)</span>
<span id="cb41-98"><a href="#cb41-98" tabindex="-1"></a><span class="bu">print</span>(fit_bfi)</span>
<span id="cb41-99"><a href="#cb41-99" tabindex="-1"></a>summary_bfi <span class="op">=</span> BFI.summary_bfi(fit_bfi, cur_mat <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-100"><a href="#cb41-100" tabindex="-1"></a></span>
<span id="cb41-101"><a href="#cb41-101" tabindex="-1"></a><span class="co"># To find a list of all datasets included in the package:</span></span>
<span id="cb41-102"><a href="#cb41-102" tabindex="-1"></a><span class="bu">print</span>(utils.data(package <span class="op">=</span> <span class="st">"BFI"</span>))</span>
<span id="cb41-103"><a href="#cb41-103" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" tabindex="-1"></a>Nurses <span class="op">=</span> data(BFI).fetch(<span class="st">'Nurses'</span>)[<span class="st">'Nurses'</span>]</span>
<span id="cb41-105"><a href="#cb41-105" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dimension of the 'Nurses' data: </span><span class="ch">\n</span><span class="st">"</span>, base.dim(Nurses))</span>
<span id="cb41-106"><a href="#cb41-106" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Colnames of the 'Nurses' data: </span><span class="ch">\n</span><span class="st">"</span>, base.colnames(Nurses))</span>
<span id="cb41-107"><a href="#cb41-107" tabindex="-1"></a></span>
<span id="cb41-108"><a href="#cb41-108" tabindex="-1"></a>trauma <span class="op">=</span> data(BFI).fetch(<span class="st">'trauma'</span>)[<span class="st">'trauma'</span>]</span>
<span id="cb41-109"><a href="#cb41-109" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dimension of the 'trauma' data: </span><span class="ch">\n</span><span class="st">"</span>, base.dim(trauma))</span>
<span id="cb41-110"><a href="#cb41-110" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Colnames of the 'trauma' data: </span><span class="ch">\n</span><span class="st">"</span>, base.colnames(trauma))</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>If you find any errors, have any suggestions, or would like to
request that something be added, please file an issue at <a href="https://github.com/hassanpazira/BFI/issues/" class="external-link">issue report</a> or
send an email to: <a href="mailto:hassan.pazira@radboudumc.nl" class="email">hassan.pazira@radboudumc.nl</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hassan Pazira, Emanuele Massa, Marianne A. Jonker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
