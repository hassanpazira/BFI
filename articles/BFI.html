<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Introduction to BFI in R • BFI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to BFI in R">
<meta name="description" content="How to use the BFI package in R.
">
<meta property="og:description" content="How to use the BFI package in R.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BFI</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BFI.html">An Introduction to BFI</a></li>
    <li><a class="dropdown-item" href="../articles/Python.html">Calling BFI from Python</a></li>
    <li><a class="dropdown-item" href="../articles/SAS.html">Using BFI in SAS</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hassanpazira/BFI"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An Introduction to BFI in R</h1>
                        <h4 data-toc-skip class="author">Hassan
Pazira</h4>
                        <h4 data-toc-skip class="author">Marianne
Jonker</h4>
            
            <h4 data-toc-skip class="date">2025-03-22</h4>
      

      <div class="d-none name"><code>BFI.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The R package <code>BFI</code> (<strong>B</strong>ayesian
<strong>F</strong>ederated <strong>I</strong>nference) provides several
functions to perform Bayesian Federated Inference for two types of
models (<code>GLM</code> and <code>Survival</code>) using multicenter
data without the need to combine or share them. This tutorial focuses on
<code>GLM</code> models. Two commonly used families for <code>GLM</code>
models, <code>"binomial"</code> and <code>"gaussian"</code>, are
available for this version of the package. The most commonly used
functions include <code><a href="../reference/BFI.html">bfi()</a></code>, <code><a href="../reference/MAP.estimation.html">MAP.estimation()</a></code>, and
<code><a href="../reference/inv.prior.cov.html">inv.prior.cov()</a></code>. In the following, we will see how the
<code>BFI</code> package can be applied to real data sets included in
the package.</p>
</div>
<div class="section level2">
<h2 id="how-to-use-it">How to use it?<a class="anchor" aria-label="anchor" href="#how-to-use-it"></a>
</h2>
<p>Before we go on, we first install and load the <code>BFI</code>
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install and load the BFI package from CRAN:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BFI"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hassanpazira.github.io/BFI/">BFI</a></span><span class="op">)</span></span></code></pre></div>
<p>By using the following code, we can see that there are two available
data sets in the package: <code>trauma</code> and
<code>Nurses</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"BFI"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>trauma</code> data set can be utilized for the
<code>"binomial"</code> family and <code>Nurses</code> data set can be
used for <code>"gaussian"</code> family. To avoid repetition, we will
only use the <code>trauma</code> data set. By loading the package, the
data sets included will be loaded and can be inspected as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the number of rows and columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 371   6</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To get an idea of the data set, print the first 7 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trauma</span>, <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sex age hospital ISS GCS mortality</span></span>
<span><span class="co">## 1   1  20        3  24  15         0</span></span>
<span><span class="co">## 2   0  38        3  34  13         0</span></span>
<span><span class="co">## 3   0  37        3  50  15         0</span></span>
<span><span class="co">## 4   0  17        3  43   4         1</span></span>
<span><span class="co">## 5   0  49        3  29  15         0</span></span>
<span><span class="co">## 6   0  30        3  22  15         0</span></span>
<span><span class="co">## 7   1  84        2  66   3         1</span></span></code></pre>
<p>This data set consists of data of 371 trauma patients from three
hospitals (peripheral hospital without a neuro-surgical unit,
<code>'status=1'</code>, peripheral hospital with a neuro-surgical unit,
<code>status=2</code>, and academic medical center,
<code>status=3</code>).</p>
<p>As we can see, the data set has six columns. The covariates
<code>sex</code> (dichotomous), <code>age</code> (continuous),
<code>ISS</code> (Injury Severity Score, continuous), and
<code>GCS</code> (Glasgow Coma Scale, continuous), which serve as the
predictors. <code>mortality</code> is the response variable, while
<code>hospital</code> is a categorical variable which indicates the
hospitals involved in the study. For more information about this data
set use</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get some info about the data set from the help file</span></span>
<span><span class="op">?</span><span class="va">trauma</span></span></code></pre></div>
<p>We will analyze the data with a <code>logistic</code> regression
model. First we standardize the covariates. This is not necessary for
the analysis, but is done for the interpretability of the accuracy of
the estimates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trauma</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="va">trauma</span><span class="op">$</span><span class="va">ISS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">$</span><span class="va">ISS</span><span class="op">)</span> </span>
<span><span class="va">trauma</span><span class="op">$</span><span class="va">GCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">$</span><span class="va">GCS</span><span class="op">)</span> </span>
<span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<p>By using the following code we can see there are three hospitals
involved in the study:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3</span></span></code></pre>
<div class="section level3">
<h3 id="map-estimations">MAP estimations<a class="anchor" aria-label="anchor" href="#map-estimations"></a>
</h3>
<p>Therefore, the <code>MAP.estimation</code> function should be applied
to these 3 local data sets separately to obtain the MAP estimations.
Note that, in practice, we do not have access to the combined data, and
each center should perform the analysis independently and send the
output to the central server, as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Center 1:</span></span>
<span><span class="co"># X1 &lt;- data.frame(sex=trauma$sex[trauma$hospital==1],</span></span>
<span><span class="co">#                  age=trauma$age[trauma$hospital==1],</span></span>
<span><span class="co">#                  ISS=trauma$ISS[trauma$hospital==1],</span></span>
<span><span class="co">#                  GCS=trauma$GCS[trauma$hospital==1])</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">trauma</span>, <span class="va">hospital</span> <span class="op">==</span> <span class="fl">1</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span>, <span class="va">ISS</span>, <span class="va">GCS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, L<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">mortality</span><span class="op">[</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>, X<span class="op">=</span><span class="va">X1</span>, family<span class="op">=</span><span class="st">"binomial"</span>, Lambda<span class="op">=</span><span class="va">Lambda1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary of the local model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    Formula: y ~ sex + age + ISS + GCS </span></span>
<span><span class="co">##     Family: 'binomial' </span></span>
<span><span class="co">##       Link: 'Logit'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std.Dev  CI 2.5% CI 97.5%</span></span>
<span><span class="co">## (Intercept)  -2.1226  0.8074  -3.7050  -0.5402</span></span>
<span><span class="co">## sex          -5.2795  2.6305 -10.4351  -0.1239</span></span>
<span><span class="co">## age           1.8864  0.7210   0.4732   3.2996</span></span>
<span><span class="co">## ISS           2.3741  0.9250   0.5611   4.1872</span></span>
<span><span class="co">## GCS          -2.4522  0.8295  -4.0781  -0.8264</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Dispersion parameter (sigma2):  1 </span></span>
<span><span class="co">##             log Lik Posterior:  -10.74 </span></span>
<span><span class="co">##                   Convergence:  0</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Center 2:</span></span>
<span><span class="co"># X2 &lt;- data.frame(sex=trauma$sex[trauma$hospital==2],</span></span>
<span><span class="co">#                  age=trauma$age[trauma$hospital==2],</span></span>
<span><span class="co">#                  ISS=trauma$ISS[trauma$hospital==2],</span></span>
<span><span class="co">#                  GCS=trauma$GCS[trauma$hospital==2])</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">trauma</span>, <span class="va">hospital</span> <span class="op">==</span> <span class="fl">2</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span>, <span class="va">ISS</span>, <span class="va">GCS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, L<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">mortality</span><span class="op">[</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span>, X<span class="op">=</span><span class="va">X2</span>, family<span class="op">=</span><span class="st">"binomial"</span>, Lambda<span class="op">=</span><span class="va">Lambda2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary of the local model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    Formula: y ~ sex + age + ISS + GCS </span></span>
<span><span class="co">##     Family: 'binomial' </span></span>
<span><span class="co">##       Link: 'Logit'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std.Dev CI 2.5% CI 97.5%</span></span>
<span><span class="co">## (Intercept)  -0.7854  0.3789 -1.5280  -0.0427</span></span>
<span><span class="co">## sex          -0.7850  0.6999 -2.1568   0.5868</span></span>
<span><span class="co">## age           1.9601  0.4662  1.0465   2.8738</span></span>
<span><span class="co">## ISS           0.5216  0.3673 -0.1983   1.2415</span></span>
<span><span class="co">## GCS          -1.8737  0.4115 -2.6803  -1.0672</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Dispersion parameter (sigma2):  1 </span></span>
<span><span class="co">##             log Lik Posterior:  -36.87 </span></span>
<span><span class="co">##                   Convergence:  0</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Center 3:</span></span>
<span><span class="co"># X3 &lt;- data.frame(sex=trauma$sex[trauma$hospital==3],</span></span>
<span><span class="co">#                  age=trauma$age[trauma$hospital==3],</span></span>
<span><span class="co">#                  ISS=trauma$ISS[trauma$hospital==3],</span></span>
<span><span class="co">#                  GCS=trauma$GCS[trauma$hospital==3])</span></span>
<span><span class="va">X3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">trauma</span>, <span class="va">hospital</span> <span class="op">==</span> <span class="fl">3</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span>, <span class="va">ISS</span>, <span class="va">GCS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lambda3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X3</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, L<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">mortality</span><span class="op">[</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">==</span><span class="fl">3</span><span class="op">]</span>, X<span class="op">=</span><span class="va">X3</span>, family<span class="op">=</span><span class="st">"binomial"</span>, Lambda<span class="op">=</span><span class="va">Lambda3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary of the local model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    Formula: y ~ sex + age + ISS + GCS </span></span>
<span><span class="co">##     Family: 'binomial' </span></span>
<span><span class="co">##       Link: 'Logit'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std.Dev CI 2.5% CI 97.5%</span></span>
<span><span class="co">## (Intercept)  -2.3144  0.4020 -3.1024  -1.5264</span></span>
<span><span class="co">## sex           0.1580  0.5714 -0.9619   1.2780</span></span>
<span><span class="co">## age           1.3031  0.2955  0.7239   1.8824</span></span>
<span><span class="co">## ISS           0.2967  0.2638 -0.2203   0.8138</span></span>
<span><span class="co">## GCS          -2.4221  0.4130 -3.2316  -1.6125</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Dispersion parameter (sigma2):  1 </span></span>
<span><span class="co">##             log Lik Posterior:  -50.63 </span></span>
<span><span class="co">##                   Convergence:  0</span></span></code></pre>
<p>It can be seen that all algorithms have converged
(<code>Convergence: 0</code>). If <code>Convergence: 1</code> occurs,
you can increase the number of iteration in the optimization process of
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> by adding <code>control = list(maxit=500)</code> to
the function <code>MAP.estimation</code>, as shown below:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example for Center 3:</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">mortality</span><span class="op">[</span><span class="va">trauma</span><span class="op">$</span><span class="va">hospital</span><span class="op">==</span><span class="fl">3</span><span class="op">]</span>, X<span class="op">=</span><span class="va">X3</span>, family<span class="op">=</span><span class="st">"binomial"</span>, Lambda<span class="op">=</span><span class="va">Lambda3</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To see more information about the data set, such as the number of
observations and parameters, we can use the output of the
<code>MAP.estimation</code> function as follows:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of samples in center 1</span></span>
<span><span class="va">fit1</span><span class="op">$</span><span class="va">n</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 49</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of parameters in center 1</span></span>
<span><span class="va">fit1</span><span class="op">$</span><span class="va">np</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of samples in center 2</span></span>
<span><span class="va">fit2</span><span class="op">$</span><span class="va">n</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 106</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of samples in center 3</span></span>
<span><span class="va">fit3</span><span class="op">$</span><span class="va">n</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 216</span></span></code></pre>
<p>Additionally, before conducting the analysis, we can use the
<code>n.par</code> function to retrieve this information.</p>
<p>The outputs <code>fit1</code>,<code>fit2</code>, and
<code>fit3</code> from the local centers should be sent to the central
server for further analysis. To send these lists from R to the central
server (which also uses R), you can save them in a format that R can
easily read, such as an RDS file.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save fit1 as an RDS file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">fit1</span>, file<span class="op">=</span><span class="st">"fit1.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save fit2 as an RDS file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">fit2</span>, file<span class="op">=</span><span class="st">"fit2.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save fit3 as an RDS file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">fit3</span>, file<span class="op">=</span><span class="st">"fit3.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bfi-estimations">BFI estimations<a class="anchor" aria-label="anchor" href="#bfi-estimations"></a>
</h3>
<p>Now, the received files can be loaded in R using the following
lines:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the RDS files</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"fit1.rds"</span><span class="op">)</span> <span class="co"># use the relative path to the file</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"fit2.rds"</span><span class="op">)</span> <span class="co"># use the relative path to the file</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"fit3.rds"</span><span class="op">)</span> <span class="co"># use the relative path to the file</span></span></code></pre></div>
<p>On the central server, the <code><a href="../reference/BFI.html">bfi()</a></code> function can be used to
obtain the BFI estimations:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit3</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span>
<span><span class="va">A_hats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit3</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span>
<span><span class="va">Lambda_com</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, L<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">Lambdas</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda1</span>, <span class="va">Lambda2</span>, <span class="va">Lambda3</span>, <span class="va">Lambda_com</span><span class="op">)</span></span>
<span><span class="va">BFI_fits</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BFI.html">bfi</a></span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambdas</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">BFI_fits</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary of the BFI model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Family: 'binomial' </span></span>
<span><span class="co">##       Link: 'Logit'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std.Dev CI 2.5% CI 97.5%</span></span>
<span><span class="co">## (Intercept)  -1.4434  0.2465 -1.9265  -0.9602</span></span>
<span><span class="co">## sex          -0.2473  0.4187 -1.0680   0.5733</span></span>
<span><span class="co">## age           1.2189  0.2190  0.7897   1.6481</span></span>
<span><span class="co">## ISS           0.4939  0.1945  0.1127   0.8751</span></span>
<span><span class="co">## GCS          -1.7375  0.2491 -2.2258  -1.2492</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Dispersion parameter (sigma2):  1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Minus the Curvature Matrix: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             (Intercept)     sex     age      ISS      GCS</span></span>
<span><span class="co">## (Intercept)     30.4330  7.7926  0.7578   8.3797 -16.6608</span></span>
<span><span class="co">## sex              7.7926  7.8026  1.3061   1.8414  -4.6925</span></span>
<span><span class="co">## age              0.7578  1.3061 31.5230  -4.8356  15.7494</span></span>
<span><span class="co">## ISS              8.3797  1.8414 -4.8356  30.7881 -11.7189</span></span>
<span><span class="co">## GCS            -16.6608 -4.6925 15.7494 -11.7189  34.4508</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="comparison">Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h3>
<p>To compare the performance of the BFI methodology, we can combine the
data sets and obtain the MAP estimations based on the combined data:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MAP estimates of the combined data:</span></span>
<span><span class="va">X_combined</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sex<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">sex</span>,</span>
<span>                          age<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">age</span>,</span>
<span>                          ISS<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">ISS</span>,</span>
<span>                          GCS<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">GCS</span><span class="op">)</span></span>
<span><span class="va">Lambda</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X_combined</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, L<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">fit_comb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">trauma</span><span class="op">$</span><span class="va">mortality</span>, X<span class="op">=</span><span class="va">X_combined</span>, family<span class="op">=</span><span class="st">"binomial"</span>, Lambda<span class="op">=</span><span class="va">Lambda</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit_comb</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary of the local model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    Formula: y ~ sex + age + ISS + GCS </span></span>
<span><span class="co">##     Family: 'binomial' </span></span>
<span><span class="co">##       Link: 'Logit'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Estimate Std.Dev CI 2.5% CI 97.5%</span></span>
<span><span class="co">## (Intercept)  -1.6255  0.2398 -2.0955  -1.1556</span></span>
<span><span class="co">## sex          -0.3357  0.3990 -1.1178   0.4463</span></span>
<span><span class="co">## age           1.3703  0.2056  0.9673   1.7733</span></span>
<span><span class="co">## ISS           0.5498  0.1862  0.1848   0.9149</span></span>
<span><span class="co">## GCS          -1.9981  0.2379 -2.4645  -1.5318</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Dispersion parameter (sigma2):  1 </span></span>
<span><span class="co">##             log Lik Posterior:  -109.4 </span></span>
<span><span class="co">##                   Convergence:  0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Minus the Curvature Matrix: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             (Intercept)     sex     age      ISS      GCS</span></span>
<span><span class="co">## (Intercept)     33.5675  8.4942  2.3840   8.3535 -18.2832</span></span>
<span><span class="co">## sex              8.4942  8.5042  1.8643   1.4055  -4.5326</span></span>
<span><span class="co">## age              2.3840  1.8643 37.1516  -6.1748  18.0223</span></span>
<span><span class="co">## ISS              8.3535  1.4055 -6.1748  33.4408 -12.8543</span></span>
<span><span class="co">## GCS            -18.2832 -4.5326 18.0223 -12.8543  38.5342</span></span></code></pre>
<p>Now, we can see the difference between the BFI and combined
estimates:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Squared Errors:</span></span>
<span><span class="op">(</span><span class="va">fit_comb</span><span class="op">$</span><span class="va">theta_hat</span> <span class="op">-</span> <span class="va">BFI_fits</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">##      (Intercept)        sex        age         ISS        GCS</span></span>
<span><span class="co">## [1,]  0.03319286 0.00781985 0.02292217 0.003132086 0.06791077</span></span></code></pre>
<p>which are close to zero, as expected!</p>
<p>For more details see the following references.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Jonker M.A., Pazira H. and Coolen A.C.C. (2024). Bayesian federated
inference for estimating statistical models based on non-shared
multicenter data sets, Statistics in Medicine, 43(12): 2421-2438. <a href="https://doi.org/10.1002/sim.10072" class="external-link uri">https://doi.org/10.1002/sim.10072</a></p>
<p>Pazira H., Massa E., Weijers J.A.M., Coolen A.C.C. and Jonker
M.A. (2025b). Bayesian Federated Inference for Survival Models, Journal
of Applied Statistics (Accepted). <a href="https://arxiv.org/abs/2404.17464" class="external-link uri">https://arxiv.org/abs/2404.17464</a></p>
<p>Jonker M.A., Pazira H. and Coolen A.C.C. (2025a). Bayesian Federated
Inference for regression models based on non-shared medical center data,
Research Synthesis Methods, 1-41. <a href="https://doi.org/10.1017/rsm.2025.6" class="external-link uri">https://doi.org/10.1017/rsm.2025.6</a></p>
<p>van den Heuvel Z.D., Pazira H. and Jonker M.A. (2025c). Bayesian
Federated Causal Inference from observational data, arXiv. <a href="https://arxiv.org/abs/???" class="external-link uri">https://arxiv.org/abs/???</a></p>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>If you find any errors, have any suggestions, or would like to
request that something be added, please file an issue at <a href="https://github.com/hassanpazira/BFI/issues/" class="external-link">issue report</a> or
send an email to: <a href="mailto:hassan.pazira@radboudumc.nl" class="email">hassan.pazira@radboudumc.nl</a> or <a href="mailto:Marianne.Jonker@radboudumc.nl" class="email">Marianne.Jonker@radboudumc.nl</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hassan Pazira, Emanuele Massa, Marianne A. Jonker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
