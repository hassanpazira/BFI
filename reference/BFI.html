<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bayesian Federated Inference — bfi • BFI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Federated Inference — bfi"><meta name="description" content="bfi function can be used (on the central server) to combine inference results from separate datasets (without combining the data) to approximate what would have been inferred had the datasets been merged. This function can handle linear, logistic and survival regression models."><meta property="og:description" content="bfi function can be used (on the central server) to combine inference results from separate datasets (without combining the data) to approximate what would have been inferred had the datasets been merged. This function can handle linear, logistic and survival regression models."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BFI</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/BFI.html">An Introduction to BFI</a></li>
    <li><a class="dropdown-item" href="../articles/Python.html">Calling BFI from Python</a></li>
    <li><a class="dropdown-item" href="../articles/SAS.html">Using BFI in SAS</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/hassanpazira/BFI"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bayesian Federated Inference</h1>

      <div class="d-none name"><code>BFI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>bfi</code> function can be used (on the central server) to combine inference results from separate datasets (without combining the data) to approximate what would have been inferred had the datasets been merged. This function can handle linear, logistic and survival regression models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bfi</span><span class="op">(</span>theta_hats <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">A_hats</span>,</span>
<span>    <span class="va">Lambda</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"binomial"</span>, <span class="st">"survival"</span><span class="op">)</span>,</span>
<span>    basehaz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weibul"</span>, <span class="st">"exp"</span>, <span class="st">"gomp"</span>, <span class="st">"poly"</span>, <span class="st">"pwexp"</span>, <span class="st">"unspecified"</span><span class="op">)</span>,</span>
<span>    stratified <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    strat_par <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    center_spec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    theta_A_polys <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    treat_round <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    for_ATE <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">p</span>,</span>
<span>    <span class="va">q_ls</span>,</span>
<span>    center_zero_sample <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="va">which_cent_zeros</span>,</span>
<span>    <span class="va">zero_sample_covs</span>,</span>
<span>    <span class="va">refer_cats</span>,</span>
<span>    <span class="va">zero_cats</span>,</span>
<span>    <span class="va">lev_no_ref_zeros</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>



<dl><dt id="arg-theta-hats">theta_hats<a class="anchor" aria-label="anchor" href="#arg-theta-hats"></a></dt>
<dd><p>a list of \(L\) vectors of the maximum a posteriori (MAP) estimates of the model parameters in the \(L\) centers. These vectors must have equal dimensions. See ‘Details’.</p></dd>


<dt id="arg-a-hats">A_hats<a class="anchor" aria-label="anchor" href="#arg-a-hats"></a></dt>
<dd><p>a list of \(L\) minus curvature matrices for \(L\) centers. These matrices must have equal dimensions. See ‘Details’.</p></dd>


<dt id="arg-lambda">Lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>a list of \(L+1\) matrices. The \(k^{\th}\) matrix is the chosen inverse variance-covariance matrix of the Gaussian distribution that is used as prior distribution in center \(k\), where \(k=1,2,\ldots,L\). The last matrix is the chosen variance-covariance matrix for the Gaussian prior of the (fictive) combined data set.
If <code>stratified = FALSE</code>, all \(L+1\) matrices must have equal dimensions. While, if <code>stratified = TRUE</code>, the first \(L\) matrices must have equal dimensions and the last matrix should have a different (greater) dimention than the others. See ‘Details’.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>a character string representing the family name used for the local centers. Can be abbreviated.</p></dd>


<dt id="arg-basehaz">basehaz<a class="anchor" aria-label="anchor" href="#arg-basehaz"></a></dt>
<dd><p>a character string representing one of the available baseline hazard functions; <code>exponential</code> (<code>"exp"</code>), <code>Weibull</code> (<code>"weibul"</code>, the default), <code>Gompertz</code> (<code>"gomp"</code>), <code>exponentiated polynomial</code> (<code>"poly"</code>), <code>piecewise exponential</code> (<code>"pwexp"</code>), and <code>unspecified baseline hazard</code> (<code>"unspecified"</code>). It is only used when <code>family = "survival"</code>. Can be abbreviated. If <code>basehaz = "unspecified"</code>, it means that a (semi-parametric) Cox model is considered, and the parameters (regression coefficients) are estimated using the partial log-likelihood.</p></dd>


<dt id="arg-stratified">stratified<a class="anchor" aria-label="anchor" href="#arg-stratified"></a></dt>
<dd><p>logical flag for performing the stratified analysis. If <code>stratified = TRUE</code>, the parameter(s) selected in the <code>strat_par</code> argument are allowed to be different across centers (to deal with heterogeneity across centers), except when the argument <code>center_spec</code> is not <code>NULL</code>. Default is <code>stratified = FALSE</code>. See ‘Details’ and ‘Examples’.</p></dd>


<dt id="arg-strat-par">strat_par<a class="anchor" aria-label="anchor" href="#arg-strat-par"></a></dt>
<dd><p>an integer vector for indicating the stratification parameter(s). It can be used to deal with heterogeneity due to center-specific parameters.
For the <code>"binomial"</code> and <code>"gaussian"</code> families it is a one- or two-element integer vector so that the values \(1\) and/or \(2\) are/is used to indicate that the “intercept” and/or “sigma2” are allowed to vary, respectively. For the <code>"binomial"</code> family the length of the vector should be at most one which refers to “intercept”, and the value of this element should be \(1\) (to handel heterogeneity across outcome means). For <code>"gaussian"</code> this vector can be \(1\) for indicating the “intercept” only (handeling heterogeneity across outcome means), \(2\) for indicating the “sigma2” only (handeling heterogeneity due to nuisance parameter), and \(c(1, 2)\) for both “intercept” and “sigma2”. When <code>family = "survival"</code>, this vector can contain any combination of values ranging from 1 to the maximum number of parameters of the baseline hazard function, i.e., \(1\) for <code>"exp"</code>, \(2\) for <code>"weibul"</code> and <code>"gomp"</code>, <code>max_order + 1</code> for <code>"poly"</code>, and <code>n_intervals</code> for <code>"pwexp"</code>.
For example, for <code>"weibul"</code>, <code>strat_par</code> could be \(1\), \(2\) or \(c(1, 2)\), where \(1\) represents \(\omega_1\) and \(2\) represents \(\omega_2\).
This argument is used only when <code>stratified = TRUE</code> and <code>center_spec = NULL</code>. Default is <code>strat_par = NULL</code>. See ‘Details’ and ‘Examples’.</p></dd>


<dt id="arg-center-spec">center_spec<a class="anchor" aria-label="anchor" href="#arg-center-spec"></a></dt>
<dd><p>a vector of \(L\) elements to account for the heterogeneity across centers due to clustering. This argument is used only when <code>stratified = TRUE</code> and <code>strat_par = NULL</code>. Each element represents a specific feature of the corresponding center. There must be only one specific value or attribute for each center. This vector could be a numeric, characteristic or factor vector. Note that, the order of the centers in the vector <code>center_spec</code> must be the same as in the list of the argument <code>theta_hats</code>.
The used data type in the argument <code>center_spec</code> must be categorical. Default is <code>center_spec = NULL</code>. See also ‘Details’ and ‘Examples’.</p></dd>


<dt id="arg-theta-a-polys">theta_A_polys<a class="anchor" aria-label="anchor" href="#arg-theta-a-polys"></a></dt>
<dd><p>a list with \(L\) elements so that each element is the array <code>theta_A_ploy</code> (the output of the <code>MAP.estimation</code> function, <code>MAP.estimation()$theta_A_ploy</code>) for the corresponding center. This argument, <code>theta_A_polys</code>, is only used if <code>family = "survival"</code> and <code>basehaz = "poly"</code>. See ‘Details’ and ‘Examples’.</p></dd>


<dt id="arg-treat-round">treat_round<a class="anchor" aria-label="anchor" href="#arg-treat-round"></a></dt>
<dd><p>a character string representing the <code>"first"</code> and <code>"second"</code> rounds of estimating the treatment effect.</p></dd>


<dt id="arg-for-ate">for_ATE<a class="anchor" aria-label="anchor" href="#arg-for-ate"></a></dt>
<dd><p>a list of \(L\) vectors of 9 elements to calculate the average treatment effects (ATEs) only for the <code>binomial</code> and <code>gaussian</code> families. These vectors must have equal dimensions. If <code>treat_round = "first"</code>, then <code>for_ATE</code> must be <code>NULL</code>. If <code>treat_round = "second"</code>, then <code>for_ATE</code> must be a list for <code>binomial</code> and <code>gaussian</code>, while for <code>survival</code>, <code>for_ATE</code> must be <code>NULL</code>. It should be defined using the output of <code>MAP.estimation()$for_ATE</code> obtained from the first round. See ‘Details’ and ‘Examples’.</p></dd>


<dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>an integer representing the number of covariates/coefficients. It can be found from the output of the <code>MAP.estimation</code> function, <code>MAP.estimation()$np</code>). This argument, <code>p</code>, is only used if <code>stratified = TRUE</code> and <code>family = "survival"</code>.</p></dd>


<dt id="arg-q-ls">q_ls<a class="anchor" aria-label="anchor" href="#arg-q-ls"></a></dt>
<dd><p>a vector with \(L\) elements in which each element is the order (minus 1) of the exponentiated polynomial baseline hazard function for the corresponding center, i.e., each element is the value of <code>q_l</code> (the output of the <code>MAP.estimation</code> function, <code>MAP.estimation()$q_l</code>). This argument, <code>q_ls</code>, is only used if <code>family = "survival"</code>, <code>family = "survival"</code> and <code>basehaz = "poly"</code>. It can also be a scalar which represents the maximum value of the <code>q_l</code>'s across the centers.</p></dd>


<dt id="arg-center-zero-sample">center_zero_sample<a class="anchor" aria-label="anchor" href="#arg-center-zero-sample"></a></dt>
<dd><p>logical flag indicating whether the center has a categorical covariate with no observations/individuals in one of the categories. It is used to address heterogeneity across centers due to center-specific covariates. Default is <code>center_zero_sample = FALSE</code>. For more detailes see ‘References’.</p></dd>


<dt id="arg-which-cent-zeros">which_cent_zeros<a class="anchor" aria-label="anchor" href="#arg-which-cent-zeros"></a></dt>
<dd><p>an integer vector representing the center(s) which has one categorical covariate with no individuals in one of the categories. It is used if <code>center_zero_sample = TRUE</code>.</p></dd>


<dt id="arg-zero-sample-covs">zero_sample_covs<a class="anchor" aria-label="anchor" href="#arg-zero-sample-covs"></a></dt>
<dd><p>a vector in which each element is a character string representing the categorical covariate that has no samples/observations in one of its categories for the corresponding center. Each element of the vector can be obtained from the output of the <code>MAP.estimation</code> function for the corresponding center, <code>MAP.estimation()$zero_sample_cov</code>. It is used when <code>center_zero_sample = TRUE</code>.</p></dd>


<dt id="arg-refer-cats">refer_cats<a class="anchor" aria-label="anchor" href="#arg-refer-cats"></a></dt>
<dd><p>a vector in which each element is a character string representing the reference category for the corresponding center. Each element of the vector can be obtained from the output of the <code>MAP.estimation</code> function for the corresponding center, <code>MAP.estimation()$refer_cat</code>. This vector is used when <code>center_zero_sample = TRUE</code>.</p></dd>


<dt id="arg-zero-cats">zero_cats<a class="anchor" aria-label="anchor" href="#arg-zero-cats"></a></dt>
<dd><p>a vector in which each element is a character string representing the category with no samples/observations for the corresponding center. Each element of the vector can be obtained from the output of the <code>MAP.estimation</code> function for the corresponding center, i.e., <code>MAP.estimation()$zero_cat</code>. It is used when <code>center_zero_sample = TRUE</code>.</p></dd>


<dt id="arg-lev-no-ref-zeros">lev_no_ref_zeros<a class="anchor" aria-label="anchor" href="#arg-lev-no-ref-zeros"></a></dt>
<dd><p>a list in which the number of elements equals the length of the <code>which_cent_zeros</code> argument. Each element of the list is a vector containing the names of the levels of the categorical covariate that has no samples/observations in one of its categories for the corresponding center. However,  the name of the category with no samples and the name of the reference category are excluded from this vector. Each element of the list can be obtained from the output of the <code>MAP.estimation</code> function, i.e., <code>MAP.estimation()$lev_no_ref_zero</code>.
This argument is used if <code>center_zero_sample = TRUE</code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>


<p><code>bfi</code> returns a list containing the following components:</p>
<dl><dt>theta_hat</dt>
<dd><p>the vector of estimates obtained by combining the inference results from the \(L\) centers with the <code>'BFI'</code> methodology. If an intercept was fitted in every center and <code>stratified = FALSE</code>, there is only one general “intercept” in this vector, while if <code>stratified = TRUE</code> and <code>strat_par = 1</code>, there are \(L\) different intercepts in the model, for each center one. If <code>treatment</code> is not '<code>NULL</code>', when <code>treat_round = 'first'</code>, <code>theta_hat</code> gives \(\hat{\boldsymbol{\gamma}}_{BFI}\), and when <code>treat_round = 'second'</code>, <code>theta_hat</code> is the treatment effect \(\hat \zeta_{BFI}\);</p></dd>


<dt>A_hat</dt>
<dd><p>minus the curvature (or Hessian) matrix obtained by the <code>'BFI'</code> method for the combined model. If <code>stratified = TRUE</code>, the dimension of the matrix is always greater than when <code>stratified = FALSE</code>;</p></dd>


<dt>sd</dt>
<dd><p>the vector of (posterior) standard deviation of the estimates in <code>theta_hat</code> obtained from the matrix in <code>A_hat</code>, i.e., the vector equals <code>sqrt(diag(solve(A_hat)))</code> which equals the square root of the elements at the diagonal of the inverse of the <code>A_hat</code> matrix.</p></dd>


<dt>family</dt>
<dd><p>the <code>family</code> object used;</p></dd>


<dt>basehaz</dt>
<dd><p>the baseline hazard function used;</p></dd>


<dt>stratified</dt>
<dd><p>whether a stratified analysis was done or not;</p></dd>


<dt>strat_par</dt>
<dd><p>the stratification parameter(s) used;</p></dd>


</dl><p><!-- %\item{S_var}{the sample variance of the treatment and control arms. It will be 'NULL' for \code{survival}.} --></p>
<dl><dt>Ave_Treat</dt>
<dd><p>the estimates of the average treatment effect. Two diffterent estimations (IPTW and wIPTW) if the family is <code>gaussian</code> or <code>binomial</code>, and for the <code>survival</code> family it is 'NULL'. For more detailes see ‘References’.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>bfi</code> function implements the BFI approach described in the papers Jonker et. al. (2024a), Pazira et. al. (2024) and Jonker et. al. (2024b) given in the references.
The inference results gathered from different (\(L\)) centers are combined, and the BFI estimates of the model parameters and curvature matrix evaluated at that point are returned.</p>
<p>The inference result from each center must be obtained using the <code>MAP.estimation</code> function separately, and then all of these results (coming from different centers) should be compiled into a list to be used as an input of <code>bfi()</code>.
The models in the different centers should be defined in exactly the same way; among others, exactly the same covariates should be included in the models. The parameter vectors should be defined exactly the same, so that the \(L\) vectors and matrices in the input lists <code>theta_hat</code>'s and <code>A_hat</code>'s are defined in the same way (e.g., the covariates need to be included in the models in the same order).</p>
<p>Note that the order of the elements in the lists <code>theta_hats</code>, <code>A_hats</code> and <code>Lambda</code>, must be the same with respect to the centers, so that in every list the element at the \(\ell^{\th}\) position is from the center \(\ell\). This should also be the case for the vector <code>center_spec</code>.</p>
<p>If for the locations <code>intercept = FALSE</code>, the stratified analysis is not possible anymore for the <code>binomial</code> family.</p>
<p>If <code>stratified = FALSE</code>, both <code>strat_par</code> and <code>center_spec</code> must be <code>NULL</code> (the defaults), while if <code>stratified = TRUE</code> only one of the two must be <code>NULL</code>.</p>
<p>If <code>stratified = FALSE</code> and all the \(L+1\) matrices in <code>Lambda</code> are equal, it is sufficient to give a (list of) one matrix only.
In both cases of the <code>stratified</code> argument (<code>TRUE</code> or <code>FALSE</code>), if only the first \(L\) matrices are equal, the argument <code>Lambda</code> can be a list of two matrices, so that the fist matrix represents the chosen variance-covariance matrix for local centers and the second one is the chosen matrix for the combined data set.
The last matrix of the list in the argument <code>Lambda</code> can be built by the function <code><a href="inv.prior.cov.html">inv.prior.cov()</a></code>.</p>
<p>If the data type used in the argument <code>center_spec</code> is continuous or categorical with the number of categories equal to the number of centers, one can use <code>stratified = TRUE</code> and <code>center_spec = NULL</code>, and set <code>strat_par</code> not to <code>NULL</code> (i.e., to \(1\), \(2\) or both \((1, 2)\)). Indeed, in this case, the stratification parameter(s) given in the argument <code>strat_par</code> are assumed to be different across the centers.</p>
<p>When <code>family = 'survival'</code> and <code>basehaz = 'poly'</code>, the arguments <code>theta_hats</code> and <code>A_hats</code> should not be provided. Instead, the <code>theta_A_polys</code> and <code>q_ls</code> arguments should be defined using the local information, specifically <code>MAP.estimation()$theta_A_poly</code> and <code>MAP.estimation()$q_l</code>, respectively. See Example 3 in ‘Examples’.</p>
<p>For estimating the treatment effect, in the first round (<code>treat_round = "first"</code>), the argument <code>for_ATE</code> must be <code>NULL</code> (the default) and the family must be set to <code>binomial</code> (family is handled automatically.)</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jonker M.A., Pazira H. and Coolen A.C.C. (2024a). <em>Bayesian federated inference for estimating statistical models based on non-shared multicenter data sets</em>, <em>Statistics in Medicine</em>, 43(12): 2421-2438. &lt;https://doi.org/10.1002/sim.10072&gt;</p>
<p>Pazira H., Massa E., Weijers J.A.M., Coolen A.C.C. and Jonker M.A. (2025b). <em>Bayesian Federated Inference for Survival Models</em>, <em>Journal of Applied Statistics (Accepted)</em>. &lt;https://arxiv.org/abs/2404.17464&gt;</p>
<p>Jonker M.A., Pazira H. and Coolen A.C.C. (2025a). <em>Bayesian Federated Inference for regression models based on non-shared medical center data</em>, <em>Research Synthesis Methods</em>, 1-41. &lt;https://doi.org/10.1017/rsm.2025.6&gt;</p>
<p><!-- %van den Heuvel Z.D., Pazira H. and Jonker M.A. (2025c). \emph{Bayesian Federated Causal Inference from observational data}, \emph{arXiv}. &lt;https://arxiv.org/abs/???&gt; --></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Hassan Pazira and Marianne Jonker <br>
Maintainer: Hassan Pazira <a href="mailto:hassan.pazira@radboudumc.nl">hassan.pazira@radboudumc.nl</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="MAP.estimation.html">MAP.estimation</a></code> and <code><a href="inv.prior.cov.html">inv.prior.cov</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#################################################</span></span></span>
<span class="r-in"><span><span class="co">##  Example 1:  y ~ Binomial  (L = 2 centers)  ##</span></span></span>
<span class="r-in"><span><span class="co">#################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting a seed for reproducibility</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">30</span>                                           <span class="co"># sample size of center 1</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variables</span></span></span>
<span class="r-in"><span><span class="va">X1x2_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'1'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># regression coefficients</span></span></span>
<span class="r-in"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>  <span class="co"># beta[1] is the intercept</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta1</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1x2_1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function ( g^{-1}(\eta) = \mu ):</span></span></span>
<span class="r-in"><span><span class="va">mu1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n1</span>, <span class="fl">1</span>, <span class="va">mu1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">50</span>                                           <span class="co"># sample size of center 2</span></span></span>
<span class="r-in"><span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n2</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variables:</span></span></span>
<span class="r-in"><span><span class="va">X2x2_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'1'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X2x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta2</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2x2_1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu2</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n2</span>, <span class="fl">1</span>, <span class="va">mu2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Assume the same inverse covariance matrix (Lambda) for both centers:</span></span></span>
<span class="r-in"><span><span class="va">Lambda</span>     <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span> <span class="co"># intercept and coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">A_hat1</span>     <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>     <span class="co"># minus the curvature matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="va">fit2</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family<span class="op">=</span><span class="st">'binomial'</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat2</span>     <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co"># BFI at Central Server #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="va">theta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">theta_hat1</span>, <span class="va">theta_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_hat1</span>, <span class="va">A_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span>        <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span>, family<span class="op">=</span><span class="st">'binomial'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">bfi</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.4479  0.8145 -0.1485   3.0444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1            2.4951  0.8978  0.7355   4.2547</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21           4.1023  1.6217  0.9239   7.2807</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22           2.2199  1.2637 -0.2570   4.6968</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      x1     x21     x22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      3.8045 -2.8450  0.7721  0.8694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1              -2.8450  4.0346 -1.2184 -0.5469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21              0.7721 -1.2184  0.7821  0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22              0.8694 -0.5469  0.0000  0.8794</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">### Stratified Analysis ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By running the following line an error appears because</span></span></span>
<span class="r-in"><span><span class="co"># when stratified = TRUE, both 'strat_par' and 'center_spec' can not be NULL:</span></span></span>
<span class="r-in"><span><span class="va">Just4check1</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                   stratified <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Just4check1</span><span class="op">)</span> <span class="co"># By default, both 'strat_par' and 'center_spec' are NULL!</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "try-error"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By running the following line an error appears because when stratified = TRUE,</span></span></span>
<span class="r-in"><span><span class="co"># last matrix in 'Lambda' should not have the same dim. as the other local matrices:</span></span></span>
<span class="r-in"><span><span class="va">Just4check2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span>, stratified <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                   strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Just4check2</span><span class="op">)</span> <span class="co"># All matices in Lambda have the same dimension!</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "try-error"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLam</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                        stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>           stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1   2.3167  2.5315 -2.6448   7.2783</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2   1.1865  0.7586 -0.3003   2.6733</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1                 1.4500  0.7562 -0.0321   2.9322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21                1.9848  1.1901 -0.3479   4.3174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22                1.3621  1.0287 -0.6542   3.3784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2      x1     x21     x22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1           0.1564           0.0000  0.0028  0.0082  0.0134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2           0.0000           3.8380 -2.8478  0.7640  0.8561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1                         0.0028          -2.8478  4.3246 -1.2184 -0.5469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21                        0.0082           0.7640 -1.2184  1.0721  0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22                        0.0134           0.8561 -0.5469  0.0000  1.1694</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">###  Treatment Effect   ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">30</span>                                           <span class="co"># sample size of center 1</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 treatment<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">X1</span><span class="op">$</span><span class="va">treatment</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression coefficients</span></span></span>
<span class="r-in"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>  <span class="co"># beta[1] is the intercept</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variable</span></span></span>
<span class="r-in"><span><span class="va">X1x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta1</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function ( g^{-1}(\eta) = \mu ):</span></span></span>
<span class="r-in"><span><span class="va">mu1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n1</span>, <span class="fl">1</span>, <span class="va">mu1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">50</span>                                           <span class="co"># sample size of center 2</span></span></span>
<span class="r-in"><span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 treatment<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n2</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">X2</span><span class="op">$</span><span class="va">treatment</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variables:</span></span></span>
<span class="r-in"><span><span class="va">X2x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta2</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu2</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n2</span>, <span class="fl">1</span>, <span class="va">mu2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The algorithm works even if the order of the covariates are not</span></span></span>
<span class="r-in"><span><span class="co"># the same across centers</span></span></span>
<span class="r-in"><span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="va">X2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treatment"</span>,<span class="st">"x1"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co">#  Observational data   #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For observational data (RWD), we need two rounds for estimating treatment effect:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span><span class="co"># First Round #</span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda1</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># In the first round, the output is without the treatment!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: treatment ~ x1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.7226  0.3968 -1.5003   0.0552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1            0.1688  0.3960 -0.6074   0.9450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -19.01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda2</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          x1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.2509259  -0.1262514 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)        x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   12.292006 -1.054369</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1            -1.054369  9.822675</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          x1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.2865479   0.3205485 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)   x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        0.01 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1                 0.00 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] treatment ~ x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "(Intercept)" "x1"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 34.21872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r1</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r1</span>, <span class="va">A_hats_r1</span>, <span class="va">Lambda1</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r1</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.3964  0.2299 -0.8470   0.0543</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           -0.0437  0.2464 -0.5266   0.4392</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     18.9205  0.3314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1               0.3314 16.4782</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span><span class="co"># Second Round #</span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda11</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda11</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># In the second round, the output is only with the treatment!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: treatment ~ x1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.6013  0.3613 -0.1068   1.3095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment     0.8123  0.6188 -0.4005   2.0251</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -34.09 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda22</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda22</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span><span class="op">$</span><span class="va">propensity</span> <span class="co"># Propensity Score</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.4011608 0.4046425 0.4016316 0.4065235 0.4013848 0.3921165 0.4006005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 0.4171208 0.3974666 0.3818413 0.4161945 0.4135265 0.4065453 0.4080270</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] 0.4035998 0.4049694 0.3868497 0.4058360 0.4051789 0.4120526 0.4130087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] 0.3800897 0.4107172 0.4150832 0.3942670 0.4036748 0.4111251 0.4017086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] 0.4014951 0.3879404 0.3867900 0.4146683 0.4038661 0.3964183 0.4211174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] 0.4029404 0.4135190 0.4144179 0.3932297 0.4003255 0.4077919 0.3905918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43] 0.4088652 0.4097657 0.3931901 0.3913643 0.3953093 0.4043939 0.4066814</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50] 0.4074400</span>
<span class="r-in"><span><span class="va">fit2_r2</span><span class="op">$</span><span class="va">for_ATE</span> <span class="co"># will be used in central server</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 22.00000 28.00000 22.00000 22.00000 54.53770 54.53770 46.87703 34.95445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [9] 21.00000</span>
<span class="r-in"><span><span class="va">fit2_r2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   treatment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.080891    5.769495 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)  treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  8.93477957 0.05763584</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment    0.05763584 0.06763584</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   treatment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    0.335471    3.855747 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept) treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        0.01      0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment          0.00      0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] treatment ~ x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "(Intercept)" "treatment"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      (Intercept)          x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  -0.3963759 -0.04370602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"names")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "(Intercept)" "x1"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.4011608 0.4046425 0.4016316 0.4065235 0.4013848 0.3921165 0.4006005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 0.4171208 0.3974666 0.3818413 0.4161945 0.4135265 0.4065453 0.4080270</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] 0.4035998 0.4049694 0.3868497 0.4058360 0.4051789 0.4120526 0.4130087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] 0.3800897 0.4107172 0.4150832 0.3942670 0.4036748 0.4111251 0.4017086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] 0.4014951 0.3879404 0.3867900 0.4146683 0.4038661 0.3964183 0.4211174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] 0.4029404 0.4135190 0.4144179 0.3932297 0.4003255 0.4077919 0.3905918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43] 0.4088652 0.4097657 0.3931901 0.3913643 0.3953093 0.4043939 0.4066814</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50] 0.4074400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 22.00000 28.00000 22.00000 22.00000 54.53770 54.53770 46.87703 34.95445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [9] 21.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 26.81176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">for_ATEs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">for_ATE</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">for_ATE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r2</span>, <span class="va">A_hats_r2</span>, <span class="va">Lambda11</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"second"</span>, for_ATE <span class="op">=</span> <span class="va">for_ATEs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">S_var</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">Ave_Treat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $IPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2269916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $wIPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.234374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.8558  0.2460  0.3737   1.3379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment     0.6510  0.5564 -0.4395   1.7416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average Treatment Effect (ATE):  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          IPTW:  0.227 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         wIPTW:  0.2344 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------#</span></span></span>
<span class="r-in"><span><span class="co">#  Randomized Trial  #</span></span></span>
<span class="r-in"><span><span class="co">#--------------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For Randomized Control Trial (RCT), we need only one round (the second round) for</span></span></span>
<span class="r-in"><span><span class="co"># estimating treatment effect. Because we do not need to estimate propensity score.</span></span></span>
<span class="r-in"><span><span class="co"># For example, in a 1:1 randomized trial, the propensity scores are, by definition,</span></span></span>
<span class="r-in"><span><span class="co"># equal to 0.5. Here we use 'RCT_propens', instead of 'gamma_bfi':</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda11</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda11</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          RCT_propens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">n1</span><span class="op">)</span><span class="op">)</span> <span class="co"># gamma_bfi = NULL</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: treatment ~ x1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.6192  0.3311 -0.0298   1.2682</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment     0.7647  0.6481 -0.5056   2.0350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -35.91 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda22</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'binomial'</span>, Lambda <span class="op">=</span> <span class="va">Lambda22</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"treatment"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          RCT_propens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">n2</span><span class="op">)</span><span class="op">)</span> <span class="co"># gamma_bfi = NULL</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span><span class="op">$</span><span class="va">for_ATE</span> <span class="co"># will be used in central server</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 22 28 22 22 44 44 56 42 21</span>
<span class="r-in"><span><span class="va">fit2_r2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   treatment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.102869    5.568164 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)  treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 10.54325177 0.05561092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment    0.05561092 0.06561092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   treatment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.3086638   3.9127752 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept) treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        0.01      0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment          0.00      0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] treatment ~ x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "(Intercept)" "treatment"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 22 28 22 22 44 44 56 42 21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 31.70768</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">for_ATEs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">for_ATE</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">for_ATE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r2</span>, <span class="va">A_hats_r2</span>, <span class="va">Lambda11</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"second"</span>, for_ATE <span class="op">=</span> <span class="va">for_ATEs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">S_var</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">Ave_Treat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $IPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $wIPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2291667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.8756  0.2259  0.4328   1.3183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatment     0.6161  0.5971 -0.5542   1.7863</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average Treatment Effect (ATE):  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          IPTW:  -0.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         wIPTW:  0.2292 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#################################################</span></span></span>
<span class="r-in"><span><span class="co">##  Example 2:  y ~ Gaussian  (L = 3 centers)  ##</span></span></span>
<span class="r-in"><span><span class="co">#################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting a seed for reproducibility</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p</span>     <span class="op">&lt;-</span> <span class="fl">3</span>                     <span class="co"># number of coefficients without 'intercept'</span></span></span>
<span class="r-in"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">p</span><span class="op">)</span>, <span class="fl">1.5</span><span class="op">)</span>  <span class="co"># reg. coef.s ('intercept' is 1) &amp; 'sigma2' = 1.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n1</span>   <span class="op">&lt;-</span> <span class="fl">30</span>                                       <span class="co"># sample size of center 1</span></span></span>
<span class="r-in"><span><span class="va">X1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n1</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous variables</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta1</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># inverse of the link function ( g^{-1}(\eta) = \mu ):</span></span></span>
<span class="r-in"><span><span class="va">mu1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, <span class="va">mu1</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n2</span>   <span class="op">&lt;-</span> <span class="fl">40</span>                                       <span class="co"># sample size of center 2</span></span></span>
<span class="r-in"><span><span class="va">X2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n2</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous variables</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta2</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mu2</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 3 #</span></span></span>
<span class="r-in"><span><span class="co">#------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n3</span>   <span class="op">&lt;-</span> <span class="fl">50</span>                                       <span class="co"># sample size of center 3</span></span></span>
<span class="r-in"><span><span class="va">X3</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n3</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n3</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous variables</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta3</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X3</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu3</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y3</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n3</span>, <span class="va">mu3</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Inverse Covariance Matrix #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Creating the inverse covariance matrix for the Gaussian prior distribution:</span></span></span>
<span class="r-in"><span><span class="co"># the same for both centers</span></span></span>
<span class="r-in"><span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.05</span>, family<span class="op">=</span><span class="st">'gaussian'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="va">fit1</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span> <span class="co"># intercept and coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">A_hat1</span>     <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>     <span class="co"># minus the curvature matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="va">fit2</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat2</span>     <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 3 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------#</span></span></span>
<span class="r-in"><span><span class="va">fit3</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y3</span>, <span class="va">X3</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat3</span> <span class="op">&lt;-</span> <span class="va">fit3</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat3</span>     <span class="op">&lt;-</span> <span class="va">fit3</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co"># BFI at Central Server #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="va">A_hats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_hat1</span>, <span class="va">A_hat2</span>, <span class="va">A_hat3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">theta_hat1</span>, <span class="va">theta_hat2</span>, <span class="va">theta_hat3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span>        <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span>, family <span class="op">=</span> <span class="st">'gaussian'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.8666  0.1008  0.6691   1.0641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            0.9385  0.1010  0.7405   1.1364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.0077  0.0969 -0.1976   0.1823</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0.0199  0.1001 -0.1762   0.2161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1.177 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      X1       X2       X3   sigma2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    103.1370 -1.6100  17.4702 -13.8002  -0.2532</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1              -1.6100 98.6784   7.0582  -2.9109  -0.2822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2              17.4702  7.0582 109.9666  -1.7587   0.0094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3             -13.8002 -2.9109  -1.7587 101.7764  -0.0120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2          -0.2532 -0.2822   0.0094  -0.0120 240.6151</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">### Stratified Analysis ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLam1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.3</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span>, L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLam1' is used as the prior for combined data and</span></span></span>
<span class="r-in"><span><span class="co"># 'Lambda' is used as the prior for locals</span></span></span>
<span class="r-in"><span><span class="va">list_newLam1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi1</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">list_newLam1</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi1</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1   0.7067  0.2132  0.2888   1.1246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2   0.9419  0.1681  0.6125   1.2713</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3   0.8819  0.1539  0.5802   1.1835</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                 0.9492  0.1022  0.7490   1.1495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                -0.0141  0.0973 -0.2048   0.1765</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                 0.0276  0.1016 -0.1715   0.2267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1.176 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2 (Intercept)_loc3      X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1          22.1366           0.0000           0.0000  3.3627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2           0.0000          38.6215           0.0000 -7.1785</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3           0.0000           0.0000          42.6288  2.2058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                         3.3627          -7.1785           2.2058 98.7284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                         1.1877           9.8374           6.4452  7.0582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                        -1.3802         -13.1667           0.7467 -2.9109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2                    -0.0723          -0.0929          -0.0880 -0.2822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        X2       X3   sigma2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1   1.1877  -1.3802  -0.0723</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2   9.8374 -13.1667  -0.0929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3   6.4452   0.7467  -0.0880</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                 7.0582  -2.9109  -0.2822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2               110.0166  -1.7587   0.0094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                -1.7587 101.8264  -0.0120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2             0.0094  -0.0120 240.8651</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'sigma2' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLam2</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.3</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">2</span>, L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLam2' is used as the prior for combined data and 'Lambda' is used as</span></span></span>
<span class="r-in"><span><span class="co"># the prior for locals</span></span></span>
<span class="r-in"><span><span class="va">list_newLam2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi2</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">list_newLam2</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi2</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.8661  0.1007  0.6687   1.0636</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            0.9380  0.1010  0.7401   1.1359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.0076  0.0969 -0.1975   0.1823</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0.0199  0.1001 -0.1763   0.2160</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1   1.3559  0.1285  1.1040   1.6079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2   1.0350  0.1115  0.8165   1.2535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3   1.1728  0.0998  0.9772   1.3683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      X1       X2       X3 sigma2_loc1 sigma2_loc2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    103.1870 -1.6100  17.4702 -13.8002     -0.0723     -0.0929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1              -1.6100 98.7284   7.0582  -2.9109     -0.0915     -0.0989</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2              17.4702  7.0582 110.0166  -1.7587      0.0081      0.0027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3             -13.8002 -2.9109  -1.7587 101.8264     -0.0110      0.0018</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1     -0.0723 -0.0915   0.0081  -0.0110     60.5223      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2     -0.0929 -0.0989   0.0027   0.0018      0.0000     80.4576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3     -0.0880 -0.0918  -0.0015  -0.0029      0.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sigma2_loc3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     -0.0880</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1              -0.0918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2              -0.0015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3              -0.0029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3    100.4852</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' and 'sigma2' vary across 2 centers:</span></span></span>
<span class="r-in"><span><span class="va">newLam3</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLam3' is used as the prior for combined data and 'Lambda' is used as</span></span></span>
<span class="r-in"><span><span class="co"># the prior for locals</span></span></span>
<span class="r-in"><span><span class="va">list_newLam3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi3</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">list_newLam3</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi3</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1   0.7075  0.2130  0.2899   1.1250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2   0.9413  0.1596  0.6284   1.2542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3   0.8819  0.1533  0.5814   1.1824</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                 0.9482  0.1018  0.7486   1.1478</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                -0.0140  0.0941 -0.1985   0.1704</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                 0.0275  0.0992 -0.1669   0.2218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1        1.3558  0.1285  1.1038   1.6077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2        1.0351  0.1115  0.8166   1.2536</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3        1.1728  0.0998  0.9773   1.3683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2 (Intercept)_loc3      X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1          22.1366           0.0000           0.0000  3.3627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2           0.0000          38.6215           0.0000 -7.1785</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3           0.0000           0.0000          42.6288  2.2058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                         3.3627          -7.1785           2.2058 98.8284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                         1.1877           9.8374           6.4452  7.0582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                        -1.3802         -13.1667           0.7467 -2.9109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1               -0.0723           0.0000           0.0000  1.1877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2                0.0000          -0.0929           0.0000  9.8374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3                0.0000           0.0000          -0.0880  6.4452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        X2       X3 sigma2_loc1 sigma2_loc2 sigma2_loc3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1  -1.3802   0.0081     -0.0723      0.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2 -13.1667   0.0027      0.0000     -0.0929      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc3   0.7467  -0.0015      0.0000      0.0000     -0.0880</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                 7.0582  -2.9109     -0.0915     -0.0989     -0.0918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2               110.1166  -1.7587      0.0081      0.0027     -0.0015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                -1.7587 101.9264     -0.0110      0.0018     -0.0029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1       -0.0915  -0.0110     60.5223      0.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2       -0.0989   0.0018      0.0000     80.4576      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc3       -0.0918  -0.0029      0.0000      0.0000    100.4852</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###----------------------------###</span></span></span>
<span class="r-in"><span><span class="co">### Center Specific Covariates ###</span></span></span>
<span class="r-in"><span><span class="co">###----------------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assume the first and third centers have the same center-specific covariate value</span></span></span>
<span class="r-in"><span><span class="co"># of 'High', while this value for the second center is 'Low', i.e.,</span></span></span>
<span class="r-in"><span><span class="co"># center_spec = c('High','Low','High')</span></span></span>
<span class="r-in"><span><span class="va">newLam4</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>, family<span class="op">=</span><span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         stratified <span class="op">=</span> <span class="cn">TRUE</span>, center_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'High'</span>,<span class="st">'Low'</span>,<span class="st">'High'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLam4' is used as the prior for combined data and 'Lambda' is used as</span></span></span>
<span class="r-in"><span><span class="co"># the prior for locals</span></span></span>
<span class="r-in"><span><span class="va">l_newLam4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi4</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">l_newLam4</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, center_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'High'</span>,<span class="st">'Low'</span>,<span class="st">'High'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi4</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_High   0.8233  0.1251  0.5781   1.0686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_Low    0.9412  0.1681  0.6117   1.2706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                 0.9454  0.1020  0.7455   1.1454</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                -0.0116  0.0971 -0.2020   0.1788</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                 0.0294  0.1015 -0.1695   0.2283</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1.176 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_High (Intercept)_Low      X1       X2       X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_High          64.6654          0.0000  5.5685   7.6329  -0.6335</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_Low            0.0000         38.6215 -7.1785   9.8374 -13.1667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                         5.5685         -7.1785 98.8284   7.0582  -2.9109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                         7.6329          9.8374  7.0582 110.1166  -1.7587</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                        -0.6335        -13.1667 -2.9109  -1.7587 101.9264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2                    -0.1603         -0.0929 -0.2822   0.0094  -0.0120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    sigma2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_High  -0.1603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_Low   -0.0929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                -0.2822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                 0.0094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                -0.0120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2           240.8651</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">###  Treatment Effect   ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># New Data for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Generating new data with 'treatment' variable</span></span></span>
<span class="r-in"><span><span class="co"># We cansider the first variable (X1$X1) to be the treatment:</span></span></span>
<span class="r-in"><span><span class="va">X1</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">eta1</span>  <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">mu1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, <span class="va">mu1</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># New Data for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># We cansider the first variable (X2$X1) to be the treatment:</span></span></span>
<span class="r-in"><span><span class="va">X2</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n2</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">eta2</span>  <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">mu2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mu2</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># New Data for Local Center 3 #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># We cansider the first variable (X3$X1) to be the treatment:</span></span></span>
<span class="r-in"><span><span class="va">X3</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n3</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta3</span>  <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X3</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu3</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y3</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n3</span>, <span class="va">mu3</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co">#  Observational data   #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For observational data (RWD), we need two rounds for estimating treatment effect:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span><span class="co"># First Round #</span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'binomial'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># When treat_round = "first", the family will automatically set to 'binomial',</span></span></span>
<span class="r-in"><span><span class="co"># even if family = 'gaussian' or family = 'survival'.</span></span></span>
<span class="r-in"><span><span class="va">fit1_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda1</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Althghou family = 'gaussian', the output is based on 'binomial'!</span></span></span>
<span class="r-in"><span><span class="co"># The output without the treatment (X1) in the first round!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: X1 ~ X2 + X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.1108  0.3732 -0.6206   0.8423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.0297  0.3798 -0.7742   0.7148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -0.4071  0.4199 -1.2301   0.4158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -20.24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda2</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          X2          X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.3157266  -0.5803330   0.1921152 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)          X2          X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    9.076073  2.39063117 -2.87755356</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2             2.390631 10.00420910 -0.09980648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            -2.877554 -0.09980648  8.73783596</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          X2          X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.3633914   0.3275755   0.3585333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)   X2   X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        0.01 0.00 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                 0.00 0.01 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                 0.00 0.00 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] X1 ~ X2 + X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "(Intercept)" "X2"          "X3"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 25.77177</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 3:</span></span></span>
<span class="r-in"><span><span class="va">Lambda3</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X3</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit3_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y3</span>, <span class="va">X3</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda3</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit3_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit3_r1</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r1</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r1</span>, <span class="va">A_hats_r1</span>, <span class="va">Lambda1</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span> <span class="co"># same results with 'binomial'</span></span></span>
<span class="r-in"><span><span class="co"># The output without the treatment (X1) in the first round!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r1</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.1594  0.1904 -0.2138   0.5325</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.1777  0.1896 -0.5494   0.1939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -0.0442  0.1943 -0.4251   0.3367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      X2      X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     28.7143  4.6181 -3.0898</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2               4.6181 28.6170  0.7706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3              -3.0898  0.7706 26.8660</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span><span class="co"># Second Round #</span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda11</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda11</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The output with only the treatment (X1) in the second round!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: X1 ~ X2 + X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.0128  0.2998  0.4251   1.6005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            0.9483  0.4266  0.1122   1.7844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  2.748 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -60.4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda22</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda22</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 3:</span></span></span>
<span class="r-in"><span><span class="va">Lambda33</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X3</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit3_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y3</span>, <span class="va">X3</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>, Lambda <span class="op">=</span> <span class="va">Lambda33</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span>,</span></span>
<span class="r-in"><span>                          gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit3_r2</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit3_r2</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">for_ATEs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">for_ATE</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">for_ATE</span>, <span class="va">fit3_r2</span><span class="op">$</span><span class="va">for_ATE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r2</span>, <span class="va">A_hats_r2</span>, <span class="va">Lambda11</span>, family <span class="op">=</span> <span class="st">'gaussian'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"second"</span>, for_ATE <span class="op">=</span> <span class="va">for_ATEs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">Ave_Treat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $IPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.045649</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $wIPTW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.055543</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">fitbfi_r2</span><span class="op">$</span><span class="va">S_var</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.9646  0.1584  0.6541   1.2750</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            1.0285  0.2245  0.5885   1.4685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  3.066 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average Treatment Effect (ATE):  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          IPTW:  1.046 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         wIPTW:  1.056 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####################################################</span></span></span>
<span class="r-in"><span><span class="co">##  Example 3:  Survival family  (L = 2 centers)  ##</span></span></span>
<span class="r-in"><span><span class="co">####################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting a seed for reproducibility</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>  <span class="co"># regression coefficients (1:4) &amp; omega's (5:6)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Simulating Survival data for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n1</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous (normal) variables</span></span></span>
<span class="r-in"><span><span class="co"># Simulating survival data ('time' and 'status') from 'Weibull' with</span></span></span>
<span class="r-in"><span><span class="co"># a predefined censoring rate of 0.3:</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="surv.simulate.html">surv.simulate</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span>, beta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    b <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>, u1 <span class="op">=</span> <span class="fl">0.1</span>, cen_rate <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>                    gen_data_from <span class="op">=</span> <span class="st">"weibul"</span><span class="op">)</span><span class="op">$</span><span class="va">D</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## MAP Estimates at Center 1</span></span></span>
<span class="r-in"><span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"survival"</span>,</span></span>
<span class="r-in"><span>                        basehaz <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'survival'</span>, Lambda <span class="op">=</span> <span class="va">Lambda</span>,</span></span>
<span class="r-in"><span>                       basehaz <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span>  <span class="co"># coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">A_hat1</span>     <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>      <span class="co"># minus the curvature matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: Survival(time, status) ~ X1 + X2 + X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘poly’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        0.6589  0.2443  0.1801   1.1378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        0.8425  0.2128  0.4255   1.2595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        1.4327  0.2359  0.9704   1.8951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  -1.5158  0.2166 -1.9403  -1.0913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   1.8742  0.3310  1.2255   2.5228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2   1.7874  0.5340  0.7408   2.8340</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log Lik Posterior:  -1.275 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Convergence:  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              X1      X2      X3 omega_0 omega_1 omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1      19.9169 -7.9165 -1.8776  2.0008  0.4276 -0.1580</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2      -7.9165 26.1009  1.3864  4.1509  0.4604  0.3718</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3      -1.8776  1.3864 23.3546  3.4463 -3.3272 -4.4365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  2.0008  4.1509  3.4463 33.5158  9.5086  7.3123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1  0.4276  0.4604 -3.3272  9.5086 15.3123  6.5539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2 -0.1580  0.3718 -4.4365  7.3123  6.5539  7.3698</span>
<span class="r-in"><span><span class="va">fit1</span><span class="op">$</span><span class="va">theta_A_poly</span> <span class="co"># Only when family = "survival" and basehaz ="poly"</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1] [,2]       [,3] [,4] [,5] [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        NA   NA  0.6589476   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        NA   NA  0.8424763   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        NA   NA  1.4327460   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0   NA   NA -1.5157831   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   NA   NA  1.8741816   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2   NA   NA  1.7874313   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2   NA   NA   NA   NA   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]       [,2]      [,3]      [,4]       [,5]       [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1      19.9168965 -7.9165022 -1.877557  2.000794  0.4276326 -0.1580233</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2      -7.9165022 26.1009020  1.386382  4.150947  0.4603776  0.3717607</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3      -1.8775567  1.3863818 23.354639  3.446257 -3.3271931 -4.4364945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  2.0007944  4.1509475  3.446257 33.515762  9.5086145  7.3122662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1  0.4276326  0.4603776 -3.327193  9.508614 15.3122662  6.5539443</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2 -0.1580233  0.3717607 -4.436494  7.312266  6.5539443  7.3698101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Simulating Survival data for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------#</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></span>
<span class="r-in"><span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n2</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous (normal) variables</span></span></span>
<span class="r-in"><span><span class="co"># Survival simulated data from 'Weibull' with a predefined censoring rate of 0.3:</span></span></span>
<span class="r-in"><span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="surv.simulate.html">surv.simulate</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span>, beta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    b <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,u1 <span class="op">=</span> <span class="fl">0.1</span>, cen_rate <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>                    gen_data_from <span class="op">=</span> <span class="st">"weibul"</span><span class="op">)</span><span class="op">$</span><span class="va">D</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## MAP Estimates at Center 2</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'survival'</span>, Lambda <span class="op">=</span> <span class="va">Lambda</span>,</span></span>
<span class="r-in"><span>                       basehaz <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit2</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: Survival(time, status) ~ X1 + X2 + X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘poly’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        0.5961  0.2320  0.1414   1.0509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        0.4218  0.1837  0.0618   0.7817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        1.2563  0.2362  0.7934   1.7192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  -1.0431  0.2075 -1.4497  -0.6365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   2.0875  0.3292  1.4422   2.7328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2  -0.1028  0.2806 -0.6528   0.4473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log Lik Posterior:  -6.197 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Convergence:  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              X1      X2      X3 omega_0 omega_1 omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1      20.3039  1.7314  2.0927  0.5517 -3.0791 -6.2397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2       1.7314 31.2288  4.3588  1.2219 -3.6742 -4.7424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3       2.0927  4.3588 24.5192  7.9651 -2.9422 -8.3513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  0.5517  1.2219  7.9651 33.0430  8.5748  8.9323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1 -3.0791 -3.6742 -2.9422  8.5748 16.9323 13.7961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2 -6.2397 -4.7424 -8.3513  8.9323 13.7961 26.8460</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co"># BFI at Central Server #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------#</span></span></span>
<span class="r-in"><span><span class="co"># When family = 'survival' and basehaz = "poly", only 'theta_A_polys'</span></span></span>
<span class="r-in"><span><span class="co"># should be defined instead of 'theta_hats' and 'A_hats':</span></span></span>
<span class="r-in"><span><span class="va">theta_A_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">theta_A_poly</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">theta_A_poly</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">qls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">q_l</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">q_l</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span>Lambda <span class="op">=</span> <span class="va">Lambda</span>, family <span class="op">=</span> <span class="st">'survival'</span>, theta_A_polys <span class="op">=</span> <span class="va">theta_A_hats</span>,</span></span>
<span class="r-in"><span>           basehaz <span class="op">=</span> <span class="st">"poly"</span>, q_ls <span class="op">=</span> <span class="va">qls</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘poly’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1        0.6009  0.1647  0.2781   0.9237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2        0.6306  0.1361  0.3638   0.8974</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3        1.2684  0.1645  0.9460   1.5908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  -1.2108  0.1483 -1.5015  -0.9201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1   2.2308  0.2386  1.7632   2.6985</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2   0.1755  0.2470 -0.3087   0.6597</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              X1      X2       X3 omega_0 omega_1  omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1      40.1208 -6.1851   0.2152  2.5525 -2.6515  -6.3977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2      -6.1851 57.2297   5.7451  5.3728 -3.2138  -4.3706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3       0.2152  5.7451  47.7738 11.4113 -6.2694 -12.7878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0  2.5525  5.3728  11.4113 65.5588 18.0834  16.2445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1 -2.6515 -3.2138  -6.2694 18.0834 31.2445  20.3501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2 -6.3977 -4.3706 -12.7878 16.2445 20.3501  33.2158</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">### Stratified Analysis ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when first parameter ('omega_0') varies across two centers:</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">newLam0</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          family <span class="op">=</span> <span class="st">'survival'</span>, stratified <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                          basehaz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poly"</span><span class="op">)</span>, strat_par <span class="op">=</span> <span class="fl">1</span>, L <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              X1 X2 X3 omega_0_loc1 omega_0_loc2 omega_1 omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            1  0  0          0.0          0.0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2            0  1  0          0.0          0.0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0  0  1          0.0          0.0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1  0  0  0          0.3          0.0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2  0  0  0          0.0          0.7       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1       0  0  0          0.0          0.0       2       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2       0  0  0          0.0          0.0       0       2</span>
<span class="r-in"><span><span class="co"># 'newLam0' is used as the prior for combined data and 'Lambda' is used as for locals:</span></span></span>
<span class="r-in"><span><span class="va">list_newLam0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi0</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span>Lambda <span class="op">=</span> <span class="va">list_newLam0</span>, family <span class="op">=</span> <span class="st">'survival'</span>, theta_A_polys <span class="op">=</span> <span class="va">theta_A_hats</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, basehaz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poly"</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">3</span>, q_ls <span class="op">=</span> <span class="va">qls</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi0</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘poly’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1             0.5812  0.1625  0.2627   0.8996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2             0.6168  0.1351  0.3520   0.8816</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3             1.2269  0.1628  0.9078   1.5460</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1  -1.2097  0.1904 -1.5829  -0.8365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2  -1.1427  0.1958 -1.5264  -0.7590</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1        2.1174  0.2307  1.6652   2.5696</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2        0.1988  0.2386 -0.2687   0.6664</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   X1      X2       X3 omega_0_loc1 omega_0_loc2 omega_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1           41.0208 -6.1851   0.2152       2.0008       0.5517 -2.6515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -6.1851 58.1297   5.7451       4.1509       1.2219 -3.2138</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0.2152  5.7451  48.6738       3.4463       7.9651 -6.2694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1  2.0008  4.1509   3.4463      32.8158       0.0000  9.5086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2  0.5517  1.2219   7.9651       0.0000      32.7430  8.5748</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1      -2.6515 -3.2138  -6.2694       9.5086       8.5748 32.2445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2      -6.3977 -4.3706 -12.7878       7.3123       8.9323 20.3501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            -6.3977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2            -4.3706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -12.7878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1   7.3123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2   8.9323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1       20.3501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2       34.2158</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when the first and second parameters ('omega_0' and 'omega_1')</span></span></span>
<span class="r-in"><span><span class="co"># vary across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLam1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         family <span class="op">=</span> <span class="st">'survival'</span>, stratified <span class="op">=</span> <span class="cn">TRUE</span>, basehaz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poly"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         strat_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, L <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLam1' is used as the prior for combined data:</span></span></span>
<span class="r-in"><span><span class="va">list_newLam1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLam1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi1</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span>Lambda <span class="op">=</span> <span class="va">list_newLam1</span>, family <span class="op">=</span> <span class="st">'survival'</span>, theta_A_polys <span class="op">=</span> <span class="va">theta_A_hats</span>,</span></span>
<span class="r-in"><span>            stratified <span class="op">=</span> <span class="cn">TRUE</span>, basehaz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poly"</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">3</span>, q_ls <span class="op">=</span> <span class="va">qls</span>,</span></span>
<span class="r-in"><span>            strat_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi1</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘poly’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1             0.5704  0.1594  0.2579   0.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2             0.6066  0.1307  0.3505   0.8627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3             1.2503  0.1471  0.9620   1.5386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1  -1.3203  0.1855 -1.6839  -0.9567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2  -1.1006  0.1792 -1.4518  -0.7493</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc1   2.4654  0.3023  1.8729   3.0579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc2   1.8937  0.3117  1.2828   2.5045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2        0.2404  0.2224 -0.1955   0.6764</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   X1      X2       X3 omega_0_loc1 omega_0_loc2 omega_1_loc1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1           41.0208 -6.1851   0.2152       2.0008       0.5517       0.4276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -6.1851 58.1297   5.7451       4.1509       1.2219       0.4604</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0.2152  5.7451  48.6738       3.4463       7.9651      -3.3272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1  2.0008  3.4463   0.4276      32.8158       0.0000       9.5086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2  0.5517  7.9651  -3.0791       0.0000      32.7430       0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc1  4.1509  7.3123   0.4604       9.5086       0.0000      14.8123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc2  1.2219  8.9323  -3.6742       0.0000       8.5748       0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2      -6.3977 -4.3706 -12.7878       7.3123       8.9323       6.5539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              omega_1_loc2  omega_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                -3.0791  -6.3977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                -3.6742  -4.3706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                -2.9422 -12.7878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc1       0.0000  -3.3272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_0_loc2       8.5748  -2.9422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc1       0.0000   6.5539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_1_loc2      16.7323  13.7961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> omega_2           13.7961  34.2158</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span><span class="co">###  Treatment Effect   ###</span></span></span>
<span class="r-in"><span><span class="co">###---------------------###</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112358</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># New Data for Local Center 1 #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># Generating new data with 'treatment' variable</span></span></span>
<span class="r-in"><span><span class="co"># We cansider the first variable (X1$X1) to be the treatment</span></span></span>
<span class="r-in"><span><span class="va">X1</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="surv.simulate.html">surv.simulate</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span>, beta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, b <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    u1 <span class="op">=</span> <span class="fl">0.1</span>, cen_rate <span class="op">=</span> <span class="fl">0.3</span>, gen_data_from <span class="op">=</span> <span class="st">"weibul"</span><span class="op">)</span><span class="op">$</span><span class="va">D</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># New Data for Local Center 2 #</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------#</span></span></span>
<span class="r-in"><span><span class="co"># We cansider the first variable (X2$X1) to be the treatment!</span></span></span>
<span class="r-in"><span><span class="va">X2</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n2</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="surv.simulate.html">surv.simulate</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span>, beta <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">]</span>, a <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, b <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    u1 <span class="op">=</span> <span class="fl">0.1</span>, cen_rate <span class="op">=</span> <span class="fl">0.3</span>, gen_data_from <span class="op">=</span> <span class="st">"weibul"</span><span class="op">)</span><span class="op">$</span><span class="va">D</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span><span class="co"># First Round #</span></span></span>
<span class="r-in"><span><span class="co">#-------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># When treat_round = "first", the family will automatically set to 'binomial',</span></span></span>
<span class="r-in"><span><span class="co"># even if family = 'gaussian' or family = 'survival'.</span></span></span>
<span class="r-in"><span><span class="va">fit1_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'survival'</span>, <span class="co"># 'basehaz' is not needed!</span></span></span>
<span class="r-in"><span>                          Lambda <span class="op">=</span> <span class="va">Lambda1</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># While family = 'survival', the output is based on 'binomial' with no 'Intercept'!</span></span></span>
<span class="r-in"><span><span class="co"># The output without the treatment (X1) in the first round!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: X1 ~ X2 + X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2  -0.0240  0.3810 -0.7708   0.7228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3  -0.4171  0.4214 -1.2429   0.4088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log Lik Posterior:  -20.28 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                         treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'survival'</span>, Lambda <span class="op">=</span> <span class="va">Lambda2</span>,</span></span>
<span class="r-in"><span>                          treatment <span class="op">=</span> <span class="st">"X1"</span>, treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          X2          X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.02520144  0.13373736 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            X2        X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2 10.4360216 0.6077938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3  0.6077938 9.4201241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        X2        X3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3101345 0.3264293 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      X2   X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2 0.01 0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3 0.00 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] X1 ~ X2 + X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X2" "X3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 20.7083</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r1</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r1</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r1</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r1</span>, <span class="va">A_hats_r1</span>, <span class="va">Lambda1</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                 treat_round <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># In the first round output is based on 'binomial', and without</span></span></span>
<span class="r-in"><span><span class="co"># the intercept and treatment (X1):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r1</span>, cur_mat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2   -0.012  0.2403 -0.4829   0.4590</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3   -0.073  0.2578 -0.5782   0.4323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         X2      X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2 17.3279  0.3298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3  0.3298 15.0539</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span><span class="co"># Second Round #</span></span></span>
<span class="r-in"><span><span class="co">#--------------#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 1:</span></span></span>
<span class="r-in"><span><span class="va">Lambda11</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                          basehaz <span class="op">=</span> <span class="st">"unspecified"</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family <span class="op">=</span> <span class="st">'survival'</span>, Lambda <span class="op">=</span> <span class="va">Lambda11</span>,</span></span>
<span class="r-in"><span>                          basehaz <span class="op">=</span> <span class="st">"unspecified"</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round <span class="op">=</span> <span class="st">"second"</span>, gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The output with only the treatment (X1) in the second round!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the local model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Formula: Survival(time, status) ~ X1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘unspecified’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1   0.7169  0.4752 -0.2145   1.6482</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log Lik Posterior:  -123.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Convergence:  0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Center 2:</span></span></span>
<span class="r-in"><span><span class="va">Lambda22</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X2</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                          basehaz <span class="op">=</span> <span class="st">"unspecified"</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round<span class="op">=</span><span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family <span class="op">=</span> <span class="st">'survival'</span>, basehaz <span class="op">=</span> <span class="st">"unspecified"</span>,</span></span>
<span class="r-in"><span>                          Lambda <span class="op">=</span> <span class="va">Lambda22</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                          treat_round <span class="op">=</span> <span class="st">"second"</span>, gamma_bfi <span class="op">=</span> <span class="va">fitbfi_r1</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2_r2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        X1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.9506257 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1 3.335594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        X1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5475369 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Survival(time, status) ~ X1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $np</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $gamma_bfi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               X2          X3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.01197287 -0.07298655</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"names")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "X2" "X3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RCT_propens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $propensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.5002803 0.5003477 0.5098637 0.4709989 0.4729075 0.5037810 0.5095445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 0.4970519 0.4899492 0.5238402 0.4896867 0.4797909 0.4702222 0.4745870</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] 0.5166537 0.4758813 0.5141528 0.5096812 0.5293850 0.4650323 0.5350887</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] 0.5327491 0.5016491 0.4745998 0.4879803 0.5057573 0.4874891 0.5053633</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] 0.5090532 0.5464391</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $for_ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_sample_cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $refer_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $zero_cat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 109.604</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "survival"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $basehaz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unspecified"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $control$maxit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Centeral Server:</span></span></span>
<span class="r-in"><span><span class="va">theta_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">theta_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">theta_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A_hats_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1_r2</span><span class="op">$</span><span class="va">A_hat</span>, <span class="va">fit2_r2</span><span class="op">$</span><span class="va">A_hat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitbfi_r2</span> <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats_r2</span>, <span class="va">A_hats_r2</span>, <span class="va">Lambda11</span>, family <span class="op">=</span> <span class="st">'survival'</span>,</span></span>
<span class="r-in"><span>                 basehaz <span class="op">=</span> <span class="st">"unspecified"</span>, treat_round <span class="op">=</span> <span class="st">"second"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># When family = 'survival', 'for_ATE' is not calculated.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">fitbfi_r2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the BFI model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘survival’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Baseline: ‘unspecified’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1   0.8183  0.3591  0.1145   1.5222</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hassan Pazira, Emanuele Massa, Marianne A. Jonker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

