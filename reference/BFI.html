<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="bfi function can be used (in the central server) to combine inference results from separate data sets (without combining the data) to approximate what would have been inferred had the data sets been merged. For now the function can handle linear and logistic regression models, but code for more models will be available in the near future.
bfi command"><title>Bayesian Federated Inference — bfi • BFI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Federated Inference — bfi"><meta property="og:description" content="bfi function can be used (in the central server) to combine inference results from separate data sets (without combining the data) to approximate what would have been inferred had the data sets been merged. For now the function can handle linear and logistic regression models, but code for more models will be available in the near future.
bfi command"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BFI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/BFI.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Python.html">Calling BFI from Python</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bayesian Federated Inference</h1>
      
      <div class="d-none name"><code>BFI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>bfi</code> function can be used (in the central server) to combine inference results from separate data sets (without combining the data) to approximate what would have been inferred had the data sets been merged. For now the function can handle linear and logistic regression models, but code for more models will be available in the near future.
bfi command</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bfi</span><span class="op">(</span>theta_hats <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span>, stratified <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    strat_par <span class="op">=</span> <span class="cn">NULL</span>, center_spec <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>theta_hats</dt>
<dd><p>a list of \(L\) vectors of the maximum a posteriori (MAP) estimates of the model parameters in the \(L\) centers. These vectors must have equal dimensions. See ‘Details’.</p></dd>


<dt>A_hats</dt>
<dd><p>a list of \(L\) (minus) curvature matrices for \(L\) centers. These matrices must have equal dimensions. See ‘Details’.</p></dd>


<dt>Lambda</dt>
<dd><p>a list of \(L+1\) matrices. The \(k^{\th}\) matrix is the chosen inverse variance-covariance matrix of the Gaussian distribution that is used as prior distribution in center \(k\), where \(k=1,2,\ldots,L\). The last matrix is the chosen variance-covariance matrix for the Gaussian prior of the (fictive) combined data set.
If <code>stratified = FALSE</code>, all \(L+1\) matrices must have equal dimensions. While, if <code>stratified = TRUE</code>, the first \(L\) matrices must have equal dimensions and the last matrix should have a different (greater) dimention than the others. See ‘Details’.</p></dd>


<dt>stratified</dt>
<dd><p>logical flag for performing the stratified analysis. If <code>stratified = TRUE</code>, the parameter(s) selected in the <code>strat_par</code> argument are allowed to be different across centers, except when the argument <code>center_spec</code> is not <code>NULL</code>. Default is <code>stratified = FALSE</code>. See ‘Details’ and ‘Examples’.</p></dd>


<dt>strat_par</dt>
<dd><p>a one- or two-element integer vector for indicating the stratification parameter(s). The values \(1\) and/or \(2\) are/is used to indicate that the ``intercept'' and/or ``sigma2'' are allowed to vary, respectively. This argument is used only when <code>stratified = TRUE</code> and <code>center_spec = NULL</code>. Default is <code>strat_par = NULL</code>, but if <code>stratified = TRUE</code>, <code>strat_par</code> can not be <code>NULL</code> unless there is a center specific variable. For the <code>binomial</code> family the length of the vector should be at most one which refers to ``intercept'', and the value of this element should be \(1\). For <code>gaussian</code> family this vector can be \(1\) for indicating the ``intercept'' only, \(2\) for indicating the ``sigma2'' only, and c(\(1\), \(2\)) for both ``intercept'' and ``sigma2''. See ‘Details’ and ‘Examples’.</p></dd>


<dt>center_spec</dt>
<dd><p>a vector of \(L\) elements for representing the center specific variable. This argument is used only when <code>stratified = TRUE</code> and <code>strat_par = NULL</code>. Each element represents a specific feature of the corresponding center. There must be only one specific value or attribute for each center. This vector could be a numeric, characteristic or factor vector. Note that, the order of the centers in the vector <code>center_spec</code> must be the same as in the list of the argument <code>theta_hats</code>.
The used data type in the argument <code>center_spec</code> must be categoricale. Default is <code>center_spec = NULL</code>. See ‘Details’ and ‘Examples’.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    


<p><code>bfi</code> returns a list containing the following components:</p>
<dl><dt>theta_hat</dt>
<dd><p>the vector of estimates obtained by combining the inference results from the \(L\) centers with the <code>'BFI'</code> methodology. If an intercept was fitted in every center and <code>stratified = FALSE</code>, there is only one general ``intercept'' in this vector, while if <code>stratified = TRUE</code> and <code>strat_par = 1</code>, there are \(L\) different intercepts in the model, for each center one;</p></dd>


<dt>A_hat</dt>
<dd><p>minus the curvature (or Hessian) matrix obtained by the <code>'BFI'</code> method for the combined model. If <code>stratified = TRUE</code>, the dimension of the matrix is always greater than when <code>stratified = FALSE</code>. When <code>stratified = TRUE</code>, some elements at the off-diagonal matrix can not be determined and are therefore <code>NA</code>;</p></dd>


<dt>sd</dt>
<dd><p>the vector of standard deviation of the estimates in <code>theta_hat</code> obtained from the matrix in <code>A_hat</code>, i.e., the vector equals <code>sqrt(diag(solve(A_hat)))</code> which equals the square root of the elements at the diagonal of the inverse of the <code>A_hat</code> matrix. If <code>stratified = TRUE</code>, then <code>sd = NULL</code> as the matrix <code>A_hat</code> is non-invertible due to <code>NA</code>'s.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>bfi</code> function implements the BFI approach described in the paper Jonker et. al. (2023) given in the references.
The inference results gathered from different (\(L\)) centers are combined, and the BFI estimates of the model parameters and curvature matrix evaluated at that point are returned.</p>
<p>The inference result from each center must be obtained using the <code>MAP.estimation</code> function separately, and then all of these results (coming from different centers) should be compiled into a list to be used as an input of <code>bfi()</code>.
The models in the different centers should be defined in exactly the same way; among others, exactly the same covariates should be included in the models. The parameter vectors should be defined exactly the same, so that the \(L\) vectors and matrices in the input lists <code>theta_hat</code>'s and <code>A_hat</code>'s are defined in the same way (e.g., the covariates need to be included in the models in the same order).</p>
<p>Note that the order of the elements in the lists <code>theta_hats</code>, <code>A_hats</code> and <code>Lambda</code>, must be the same with respect to the centers, so that in every list the element at the \(\ell^{\th}\) position is from the center \(\ell\). This should also be the case for the vector <code>center_spec</code>.</p>
<p>If for the locations <code>intercept = FALSE</code>, the stratified analysis is not possible anymore for the <code>binomial</code> family.</p>
<p>If <code>stratified = FALSE</code>, both <code>strat_par</code> and <code>center_spec</code> must be <code>NULL</code> (the defaults), while if <code>stratified = TRUE</code> only one of the two must be <code>NULL</code>.</p>
<p>If <code>stratified = FALSE</code> and all the \(L+1\) matrices are equal, it is sufficient to give a (list of) one matrix only.
In both cases of the <code>stratified</code> argument (<code>TRUE</code> or <code>FALSE</code>), if only the first \(L\) matrices are equal, the argument <code>Lambda</code> can be a list of two matrices, so that the fist matrix represents the chosen variance-covariance matrix for local centers and the second one is the chosen matrix for the combined data set.
The last matrix of the list in the argument <code>Lambda</code> can be built by the function <code><a href="inv.prior.cov.html">inv.prior.cov()</a></code>.</p>
<p>If the data type used in the argument <code>center_spec</code> is continuous, one can use <code>stratified = TRUE</code> and <code>center_spec = NULL</code>, and set <code>strat_par</code> not to <code>NULL</code> (i.e., to \(1\), \(2\) or \((1, 2)\)). Indeed, in this case, the stratification parameter(s) given in the argument <code>strat_par</code> are assumed to be different across the centers.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jonker M.A., Pazira H. and Coolen A.C.C. (2023). <em>Bayesian Federated Inference for Statistical Models</em>. Statistics in Medicine, Vol. 0(0), 0-0. &lt;https://doi.org/10.48550/arXiv.2302.07677&gt;</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Hassan Pazira<br>
Maintainer: Hassan Pazira <a href="mailto:hassan.pazira@radboudumc.nl">hassan.pazira@radboudumc.nl</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="MAP.estimation.html">MAP.estimation</a></code> and <code><a href="inv.prior.cov.html">inv.prior.cov</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span><span class="co">##  Example 1: y ~ Binomial  ##</span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#------------------</span></span></span>
<span class="r-in"><span><span class="co"># Model Assumption:</span></span></span>
<span class="r-in"><span><span class="co">#------------------</span></span></span>
<span class="r-in"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>  <span class="co"># regression coefficients (beta[1] is the intercept)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 1</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">30</span>                                           <span class="co"># sample size of center 1</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n1</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variables</span></span></span>
<span class="r-in"><span><span class="va">X1x2_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'1'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta1</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1x2_1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">X1x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function ( g^{-1}(\eta) = \mu ):</span></span></span>
<span class="r-in"><span><span class="va">mu1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n1</span>, <span class="fl">1</span>, <span class="va">mu1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 2</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">50</span>                                           <span class="co"># sample size of center 2</span></span></span>
<span class="r-in"><span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span><span class="op">)</span>,                     <span class="co"># continuous variable</span></span></span>
<span class="r-in"><span>                 x2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n2</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical variable</span></span></span>
<span class="r-in"><span><span class="co"># make dummy variables:</span></span></span>
<span class="r-in"><span><span class="va">X2x2_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'1'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X2x2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span> <span class="op">==</span> <span class="st">'2'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X2</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta2</span>   <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2</span><span class="op">$</span><span class="va">x1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2x2_1</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">X2x2_2</span> <span class="op">*</span> <span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu2</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n2</span>, <span class="fl">1</span>, <span class="va">mu2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 1</span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="co"># assume the same inverse covariance matrix (Lambda) for both centers:</span></span></span>
<span class="r-in"><span><span class="va">Lambda</span>     <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fl">0.01</span>, family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family<span class="op">=</span><span class="va">binomial</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span> <span class="co"># intercept and coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">A_hat1</span>     <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>     <span class="co"># minus the curvature matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 2</span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="va">fit2</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family<span class="op">=</span><span class="va">binomial</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat2</span>     <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------</span></span></span>
<span class="r-in"><span><span class="co"># BFI at Central Center</span></span></span>
<span class="r-in"><span><span class="co">#----------------------</span></span></span>
<span class="r-in"><span><span class="va">A_hats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_hat1</span>, <span class="va">A_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">theta_hat1</span>, <span class="va">theta_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span>        <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">bfi</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘binomial’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘Logit’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.0485  0.7010 -0.3254   2.4223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1            1.9629  0.6835  0.6233   3.3025</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21           2.3456  1.3089 -0.2198   4.9110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22           3.6459  1.3241  1.0507   6.2410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      x1     x21     x22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      4.4971 -3.4915  0.7747  0.8442</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1              -3.4915  5.2611 -0.8013 -1.0915</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21              0.7747 -0.8013  0.7847  0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22              0.8442 -1.0915  0.0000  0.8542</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------</span></span></span>
<span class="r-in"><span><span class="co"># Stratified Analysis</span></span></span>
<span class="r-in"><span><span class="co">#--------------------</span></span></span>
<span class="r-in"><span><span class="co"># By running the following line an error appears because when stratified = TRUE,</span></span></span>
<span class="r-in"><span><span class="co"># both 'strat_par' and 'center_spec' can not be NULL:</span></span></span>
<span class="r-in"><span><span class="co"># bfi(theta_hats, A_hats, Lambda, stratified=TRUE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By running the following line an error appears because when stratified = TRUE,</span></span></span>
<span class="r-in"><span><span class="co"># last matrix in 'Lambda' should not have the same dim. as the other local matrices:</span></span></span>
<span class="r-in"><span><span class="co"># bfi(theta_hats, A_hats, Lambda, stratified=TRUE, strat_par=1)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>, family<span class="op">=</span><span class="va">binomial</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLambda</span><span class="op">)</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1 (Intercept)_loc2               x1              x21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0.5841092        1.8844845        1.5757827        1.6887455 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              x22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1.7981788 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2         x1        x21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1        2.6151236               NA -1.5037487  0.7168312</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2               NA        2.0720113 -1.9877118  0.0579052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1                     -1.5037487       -1.9877118  5.5510870 -0.8013101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21                     0.7168312        0.0579052 -0.8013101  1.0747364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22                     0.0549650        0.7891917 -1.0914712  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         x22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1  0.0549650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2  0.7891917</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1               -1.0914712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x21               0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x22               1.1441567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "binomial"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stratified</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span><span class="co"># summary() does not work for the stratified analysis!</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span><span class="co">##  Example 2: y ~ Gaussian  ##</span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-------------------</span></span></span>
<span class="r-in"><span><span class="co"># Model Assumptions:</span></span></span>
<span class="r-in"><span><span class="co">#-------------------</span></span></span>
<span class="r-in"><span><span class="va">p</span>     <span class="op">&lt;-</span> <span class="fl">3</span>                     <span class="co"># number of coefficients without intercept</span></span></span>
<span class="r-in"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">p</span><span class="op">)</span>, <span class="fl">1.5</span><span class="op">)</span>  <span class="co"># regression coefficients (theta[1] is the intercept) and sigma2 = 1.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 1</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="va">n1</span>   <span class="op">&lt;-</span> <span class="fl">30</span>                                       <span class="co"># sample size of center 1</span></span></span>
<span class="r-in"><span><span class="va">X1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n1</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous variables</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta1</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function ( g^{-1}(\eta) = \mu ):</span></span></span>
<span class="r-in"><span><span class="va">mu1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, <span class="va">mu1</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Data Simulation for Local Center 2</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------</span></span></span>
<span class="r-in"><span><span class="va">n2</span>   <span class="op">&lt;-</span> <span class="fl">50</span>                                       <span class="co"># sample size of center 2</span></span></span>
<span class="r-in"><span><span class="va">X2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n2</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># continuous variables</span></span></span>
<span class="r-in"><span><span class="co"># linear predictor:</span></span></span>
<span class="r-in"><span><span class="va">eta2</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># inverse of the link function:</span></span></span>
<span class="r-in"><span><span class="va">mu2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mu2</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Inverse Covariance Matrix</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Creating the inverse covariance matrix for the Gaussian prior distribution:</span></span></span>
<span class="r-in"><span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fl">0.05</span>, family<span class="op">=</span><span class="va">gaussian</span><span class="op">)</span> <span class="co"># the same for both centers</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 1</span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="va">fit1</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">X1</span>, family<span class="op">=</span><span class="va">gaussian</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">theta_hat</span> <span class="co"># intercept and coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">A_hat1</span>     <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">A_hat</span>     <span class="co"># minus the curvature matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="co"># MAP Estimates at Center 2</span></span></span>
<span class="r-in"><span><span class="co">#--------------------------</span></span></span>
<span class="r-in"><span><span class="va">fit2</span>       <span class="op">&lt;-</span> <span class="fu"><a href="MAP.estimation.html">MAP.estimation</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">X2</span>, family<span class="op">=</span><span class="va">gaussian</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hat2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">theta_hat</span></span></span>
<span class="r-in"><span><span class="va">A_hat2</span>     <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">A_hat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------</span></span></span>
<span class="r-in"><span><span class="co"># BFI at Central Center</span></span></span>
<span class="r-in"><span><span class="co">#----------------------</span></span></span>
<span class="r-in"><span><span class="va">A_hats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_hat1</span>, <span class="va">A_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">theta_hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">theta_hat1</span>, <span class="va">theta_hat2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfi</span>        <span class="op">&lt;-</span> <span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="va">Lambda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="summary.bfi.html">summary</a></span><span class="op">(</span><span class="va">bfi</span>, cur_mat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Family: ‘gaussian’ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Link: ‘identity’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std.Dev CI 2.5% CI 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.2207  0.1494  0.9280   1.5135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            2.1392  0.1407  1.8636   2.4149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2            2.0999  0.1753  1.7563   2.4435</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            1.8713  0.1395  1.5980   2.1447</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter (sigma2):  1.762 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minus the Curvature Matrix: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)      X1      X2      X3   sigma2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     45.7189 -4.3872  3.7431 -2.3488  -0.2347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1              -4.3872 51.1707 -1.2155  3.1482  -0.4351</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2               3.7431 -1.2155 33.1334  3.5340  -0.4215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3              -2.3488  3.1482  3.5340 52.1412  -0.3950</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2          -0.2347 -0.4351 -0.4215 -0.3950 160.6676</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--------------------</span></span></span>
<span class="r-in"><span><span class="co"># Stratified Analysis</span></span></span>
<span class="r-in"><span><span class="co">#--------------------</span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>, family<span class="op">=</span><span class="va">gaussian</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLambda1' is used the prior for combined data and 'Lambda' is used the prior for locals</span></span></span>
<span class="r-in"><span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLambda1</span><span class="op">)</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1 (Intercept)_loc2               X1               X2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1.149763         1.250646         2.140754         2.105212 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               X3           sigma2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1.868741         1.758807 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2         X1          X2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1       15.6246576               NA  0.3885325  3.81187956</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2               NA      30.24419579 -4.7757311 -0.06874582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                      0.3885325      -4.77573115 51.2206990 -1.21547306</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                      3.8118796      -0.06874582 -1.2154731 33.18341817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                     -0.8711607      -1.47761649  3.1481753  3.53402501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2                 -0.1138746      -0.12085349 -0.4351469 -0.42147868</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          X3      sigma2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1 -0.8711607  -0.1138746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2 -1.4776165  -0.1208535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                3.1481753  -0.4351469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                3.5340250  -0.4214787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3               52.1911656  -0.3949931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2           -0.3949931 160.9176100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "gaussian"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stratified</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'sigma2' varies across two centers:</span></span></span>
<span class="r-in"><span><span class="va">newLambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>, family<span class="op">=</span><span class="va">gaussian</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLambda2' is used the prior for combined data and 'Lambda' is used the prior for locals</span></span></span>
<span class="r-in"><span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLambda2</span><span class="op">)</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          X1          X2          X3 sigma2_loc1 sigma2_loc2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.219464    2.137397    2.097346    1.870147    1.921586    1.655427 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)         X1         X2         X3 sigma2_loc1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  45.7688534 -4.3871987  3.7431337 -2.3487772  -0.1138746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1           -4.3871987 51.2206990 -1.2154731  3.1481753  -0.2366625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2            3.7431337 -1.2154731 33.1834182  3.5340250  -0.2233656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -2.3487772  3.1481753  3.5340250 52.1911656  -0.2298598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1  -0.1138746 -0.2366625 -0.2233656 -0.2298598  60.6368284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2  -0.1208535 -0.1984844 -0.1981131 -0.1651333          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sigma2_loc2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.1208535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1           -0.1984844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.1981131</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -0.1651333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2 100.5807816</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "gaussian"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stratified</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stratified analysis when 'intercept' and 'sigma2' vary across 2 centers:</span></span></span>
<span class="r-in"><span><span class="va">newLambda3</span> <span class="op">&lt;-</span> <span class="fu"><a href="inv.prior.cov.html">inv.prior.cov</a></span><span class="op">(</span><span class="va">X1</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>, family<span class="op">=</span><span class="va">gaussian</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'newLambda3' is used the prior for combined data and 'Lambda' is used the prior for locals</span></span></span>
<span class="r-in"><span><span class="fu">bfi</span><span class="op">(</span><span class="va">theta_hats</span>, <span class="va">A_hats</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Lambda</span>, <span class="va">newLambda3</span><span class="op">)</span>, stratified<span class="op">=</span><span class="cn">TRUE</span>, strat_par<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $theta_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1 (Intercept)_loc2               X1               X2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1.152375         1.249474         2.136817         2.099187 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               X3      sigma2_loc1      sigma2_loc2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1.866211         1.921450         1.655459 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A_hat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  (Intercept)_loc1 (Intercept)_loc2          X1         X2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1       15.6246576               NA  0.38853250 -0.8711607</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2               NA      30.24419579 -4.77573115 -1.4776165</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                      0.3885325      -4.77573115 51.32069904 -1.2154731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                      3.8118796      -0.06874582 -1.21547306 33.2834182</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3                     -0.8711607      -1.47761649  3.14817528  3.5340250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1            -0.1138746               NA  3.81187956 -0.2366625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2                    NA      -0.12085349 -0.06874582 -0.1984844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          X3 sigma2_loc1 sigma2_loc2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc1 -0.2233656  -0.1138746          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)_loc2 -0.1981131          NA  -0.1208535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1                3.1481753  -0.2366625  -0.1984844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2                3.5340250  -0.2233656  -0.1981131</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3               52.2911656  -0.2298598  -0.1651333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc1      -0.2298598  60.6368284          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma2_loc2      -0.1651333          NA 100.5807816</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $family</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "gaussian"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stratified</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bfi"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Hassan Pazira, Marianne A. Jonker, Anthony C.C. Coolen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

